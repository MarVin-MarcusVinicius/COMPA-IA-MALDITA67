<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marvin en Compa√±√≠a Maldita 67 - Espacio Marvin</title>
    <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
            transition: all 0.3s ease;
            overflow-x: hidden;
        }

        /* Modo Noche (por defecto) */
        body.night-mode {
            background: linear-gradient(135deg, #2d4a2b, #3d5a3b, #4d6a4b);
            background-attachment: fixed;
            color: #e8f5e8;
        }

        /* Modo D√≠a */
        body.day-mode {
            background-image: url(/assets/images/PERFIL67.png);
            background: linear-gradient(135deg, #87ceeb, #98d8e8, #b0e0e6);
            background-attachment: fixed;
            color: #2c3e50;
        }

        .header {
            background: linear-gradient(90deg, #1a2f1a, #2d4a2b);
            padding: 1rem 0;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            position: sticky;
            top: 0;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .day-mode .header {
            background: linear-gradient(90deg, #34495e, #2c3e50);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .company-logo {
            width: 100px;
            height: 100px;
            min-width: 100px;
            min-height: 100px;
            background: linear-gradient(45deg, #8b4513, #a0522d);
            border: 6px solid #ffd700;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: #ffd700;
            font-weight: bold;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-sizing: border-box;
            flex-shrink: 0;
        }

        .company-name {
            font-size: 1rem;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .nav-menu {
            display: flex;
            gap: 3rem;
            list-style: none;
            margin: 0;
            padding: 0;
            align-items: center;
        }

        .nav-menu li a {
            color: #e8f5e8;
            text-decoration: none;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .nav-menu li a:hover, .nav-menu li a.active {
            background: rgba(255, 215, 0, 0.2);
            color: #f5f4f1cb;
        }

        .theme-toggle {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            color: #2c3e50;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .theme-toggle:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }

        .clear-data-btn {
            background: linear-gradient(45deg, #dc3545, #c82333);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            color: white;
            transition: all 0.3s ease;
            margin-left: 1rem;
        }

        .clear-data-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }

        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .hero-section {
            text-align: center;
            padding: 4rem 2rem;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            margin-bottom: 3rem;
            backdrop-filter: blur(5px);
        }

        .day-mode .hero-section {
            background: rgba(255,255,255,0.3);
        }

        .hero-title {
            font-size: 3rem;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.7);
            margin-bottom: 1rem;
        }

        .hero-subtitle {
            font-size: 1.3rem;
            margin-bottom: 2rem;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }

        .form-container {
            background: rgba(0,0,0,0.4);
            padding: 2rem;
            border-radius: 12px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            max-width: 600px;
            margin: 0 auto;
        }

        .day-mode .form-container {
            background: rgba(255,255,255,0.4);
            border-color: rgba(52, 73, 94, 0.3);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            color: #ffd700;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 6px;
            background: rgba(0,0,0,0.3);
            color: inherit;
            font-size: 1rem;
        }

        .day-mode .form-group input, 
        .day-mode .form-group select, 
        .day-mode .form-group textarea {
            background: rgba(255,255,255,0.3);
            border-color: rgba(52, 73, 94, 0.3);
        }

        .submit-btn {
            background: linear-gradient(45deg, #8b4513, #a0522d);
            color: #ffd700;
            border: 2px solid #ffd700;
            padding: 1rem 2rem;
            border-radius: 6px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            background: linear-gradient(45deg, #a0522d, #8b4513);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #ffd700;
            font-size: 1.2rem;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-menu {
                flex-wrap: wrap;
                justify-content: center;
            }

            .hero-title {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body class="night-mode">
    <header class="header">
        <div class="nav-container">
            <div class="logo">
    
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <div class="company-name">MARVIN</div>
                    <div class="company-logo">
                    <span id="logoText">SD</span>
                </div>
                    <div>üá™üá∏</div>
                    <div id="liveStats" style="background: rgba(255, 215, 0, 0.2); padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.8rem; color: #ffd700; border: 1px solid rgba(255, 215, 0, 0.3);">
                        üë• 0 | üì∑ 0 | üìÖ 0
                    </div>
                </div>
            </div>
            <nav>
                <ul class="nav-menu">
                    <li><a onclick="showPage('inicio')" class="nav-link active">Inicio</a></li>
                    <li><a onclick="showPage('registro')" class="nav-link">Registro</a></li>
                    <li><a onclick="showPage('miembros')" class="nav-link">Miembros</a></li>
                    <li><a onclick="showPage('formaciones')" class="nav-link">Eventos</a></li>
                    <li><a onclick="showPage('multimedia')" class="nav-link">Multimedia</a></li>
                    <li><a onclick="showPage('informacion')" class="nav-link">Informaciones</a></li>
                    <li><button class="theme-toggle" onclick="toggleTheme()" id="themeBtn">üåô Modo D√≠a</button></li>
                    <li><button class="clear-data-btn" onclick="clearAllData()">üóëÔ∏è Limpiar Datos</button></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <!-- P√ÅGINA INICIO -->
        <div id="inicio" class="page active">
            <section class="hero-section">
                <h1 class="hero-title">COMPA√ë√çA MALDITA 67¬™ REGIMIENTO</h1>
                <p class="hero-subtitle">Regimiento Militar de √âlite</p>
                <p class="hero-subtitle">"Honor, Valor y Disciplina"</p>
            </section>
            
            <div class="form-container">
                <h2 style="color: #ffd700; text-align: center; margin-bottom: 2rem;">Bienvenido a la Compa√±√≠a</h2>
                <p style="text-align: center; line-height: 1.6;">
                    Somos una compa√±√≠a de misiones de paz especializada en ayudar a comunidades en conflicto, pero preparados para enfrentar enemigos en todo tipo de situaciones. Nuestros miembros provienen de diferentes pa√≠ses y culturas, unidos por los valores de honor, valor y disciplina.
                </p>
                <p style="text-align: center; line-height: 1.6; margin-top: 1rem;">
                    Con experiencias en m√∫ltiples situaciones de combate, estamos listos para cualquier desaf√≠o que se presente en nuestras misiones de paz.
                </p>
            </div>
        </div>

        <!-- P√ÅGINA REGISTRO -->
        <div id="registro" class="page">
            <div class="form-container">
                <h2 style="color: #ffd700; text-align: center; margin-bottom: 2rem;">Registro de Nuevo Miembro</h2>
                <form id="registroForm">
                    <div class="form-group">
                        <label for="nombre">Nombre:</label>
                        <input type="text" id="nombre" name="nombre" required>
                    </div>
                    <div class="form-group">
                        <label for="edad">Edad:</label>
                        <input type="number" id="edad" name="edad" min="18" max="65" required>
                    </div>
                    <div class="form-group">
                        <label for="nacionalidad">Nacionalidad:</label>
                        <select id="nacionalidad" name="nacionalidad" required>
                            <option value="">ESCOLHER PA√çS DE ORIGEN...</option>
                            <option value="Espa√±a">üá™üá∏ Espa√±a</option>
                            <option value="Francia">üá´üá∑ Francia</option>
                            <option value="Italia">üáÆüáπ Italia</option>
                            <option value="Portugal">üáµüáπ Portugal</option>
                            <option value="M√©xico">üá≤üáΩ M√©xico</option>
                            <option value="Argentina">üá¶üá∑ Argentina</option>
                            <option value="Colombia">üá®üá¥ Colombia</option>
                            <option value="Brasil">üáßüá∑ Brasil</option>
                                <option value="Argentina">üá¶üá∑ Argentina</option>
                                <option value="Bolivia">üáßüá¥ Bolivia</option>
                                <option value="Chile">üá®üá± Chile</option>
                                <option value="Ecuador">üá™üá® Ecuador</option>
                                <option value="Guyana">üá¨üáæ Guyana</option>
                                <option value="Paraguay">üáµüáæ Paraguay</option>
                                <option value="Per√∫">üáµüá™ Per√∫</option>
                                <option value="Surinam">üá∏üá∑ Surinam</option>
                                <option value="Uruguay">üá∫üáæ Uruguay</option>
                                <option value="Venezuela">üáªüá™ Venezuela</option>
  <option value="Alemania">üá©üá™ Alemania</option>
  <option value="Andorra">üá¶üá© Andorra</option>
  <option value="Austria">üá¶üáπ Austria</option>
  <option value="B√©lgica">üáßüá™ B√©lgica</option>
  <option value="Bosnia y Herzegovina">üáßüá¶ Bosnia y Herzegovina</option>
  <option value="Bulgaria">üáßüá¨ Bulgaria</option>
  <option value="Croacia">üá≠üá∑ Croacia</option>
  <option value="Dinamarca">üá©üá∞ Dinamarca</option>
  <option value="Eslovaquia">üá∏üá∞ Eslovaquia</option>
  <option value="Eslovenia">üá∏üáÆ Eslovenia</option>
  <option value="Espa√±a">üá™üá∏ Espa√±a</option>
  <option value="Estonia">üá™üá™ Estonia</option>
  <option value="Finlandia">üá´üáÆ Finlandia</option>
  <option value="Francia">üá´üá∑ Francia</option>
  <option value="Grecia">üá¨üá∑ Grecia</option>
  <option value="Hungr√≠a">üá≠üá∫ Hungr√≠a</option>
  <option value="Irlanda">üáÆüá™ Irlanda</option>
  <option value="Islandia">üáÆüá∏ Islandia</option>
  <option value="Italia">üáÆüáπ Italia</option>
  <option value="Letonia">üá±üáª Letonia</option>
  <option value="Lituania">üá±üáπ Lituania</option>
  <option value="Luxemburgo">üá±üá∫ Luxemburgo</option>
  <option value="Malta">üá≤üáπ Malta</option>
  <option value="Moldavia">üá≤üá© Moldavia</option>
  <option value="M√≥naco">üá≤üá® M√≥naco</option>
  <option value="Noruega">üá≥üá¥ Noruega</option>
  <option value="Pa√≠ses Bajos">üá≥üá± Pa√≠ses Bajos</option>
  <option value="Polonia">üáµüá± Polonia</option>
  <option value="Portugal">üáµüáπ Portugal</option>
  <option value="Reino Unido">üá¨üáß Reino Unido</option>
  <option value="Rep√∫blica Checa">üá®üáø Rep√∫blica Checa</option>
  <option value="Ruman√≠a">üá∑üá¥ Ruman√≠a</option>
  <option value="Rusia">üá∑üá∫ Rusia</option>
  <option value="San Marino">üá∏üá≤ San Marino</option>
  <option value="Serbia">üá∑üá∏ Serbia</option>
  <option value="Suecia">üá∏üá™ Suecia</option>
  <option value="Suiza">üá®üá≠ Suiza</option>
  <option value="Ucrania">üá∫üá¶ Ucrania</option>
  <option value="Vaticano">üáªüá¶ Vaticano</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="rango">Rango:</label>
                        <select id="rango" name="rango" required>
                            <option value="">Seleccionar rango...</option>
                            <option value="Infanter√≠a">Infanter√≠a</option>
                            <option value="Soldado">Soldado</option>
                            <option value="Soldado Primero">Soldado Primero</option>
                            <option value="Cabo">Cabo</option>
                            <option value="Cabo Primero">Cabo Primero</option>
                            <option value="Sargento">Sargento</option>
                            <option value="Sargento Primero">Sargento Primero</option>
                            <option value="Teniente">Teniente</option>
                            <option value="Teniente Primero">Teniente Primero</option>
                            <option value="Capit√°n">Capit√°n</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="especialidad">Especialidad:</label>
                        <select id="especialidad" name="especialidad" required>
                            <option value="">Seleccionar especialidad...</option>
                            <option value="Infanter√≠a">Infanter√≠a</option>
                            <option value="Artiller√≠a">Artiller√≠a</option>
                            <option value="Ingenieros">Ingenieros</option>
                            <option value="Comunicaciones">Comunicaciones</option>
                            <option value="M√©dico">M√©dico</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="fotoPerfil">üñºÔ∏è Foto de Perfil:</label>
                        
                        <!-- Selector de m√©todo -->
                        <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; background: rgba(255, 215, 0, 0.1); padding: 0.5rem 1rem; border-radius: 6px; border: 2px solid rgba(255, 215, 0, 0.3);">
                                <input type="radio" name="photoMethod" value="file" checked onchange="togglePhotoMethod('file')" style="margin: 0;">
                                üìÅ Subir Archivo
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; background: rgba(255, 215, 0, 0.1); padding: 0.5rem 1rem; border-radius: 6px; border: 2px solid rgba(255, 215, 0, 0.3);">
                                <input type="radio" name="photoMethod" value="url" onchange="togglePhotoMethod('url')" style="margin: 0;">
                                üîó URL Externa
                            </label>
                        </div>
                        
                        <!-- Subir archivo -->
                        <div id="fileUploadSection">
                            <input type="file" id="fotoPerfilFile" name="fotoPerfilFile" accept="image/*" onchange="handleFileSelect(this)" style="width: 100%; padding: 0.8rem; border: 2px dashed rgba(255, 215, 0, 0.5); border-radius: 6px; background: rgba(0,0,0,0.3); color: inherit; font-size: 1rem; cursor: pointer;">
                            <small style="opacity: 0.7; font-size: 0.8rem; display: block; margin-top: 0.5rem;">
                                üì∑ Selecciona una imagen desde tu dispositivo (.jpg, .png, .gif, .webp)<br>
                                üí° Tama√±o m√°ximo recomendado: 5MB
                            </small>
                            
                            <!-- Vista previa -->
                            <div id="imagePreview" style="display: none; margin-top: 1rem; text-align: center;">
                                <div style="display: inline-block; position: relative;">
                                    <img id="previewImg" style="width: 100px; height: 100px; object-fit: cover; border-radius: 50%; border: 3px solid #ffd700; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);">
                                    <button type="button" onclick="clearImagePreview()" style="position: absolute; top: -5px; right: -5px; width: 25px; height: 25px; border-radius: 50%; background: #dc3545; color: white; border: none; cursor: pointer; font-size: 0.8rem; display: flex; align-items: center; justify-content: center;">‚úï</button>
                                </div>
                                <div style="margin-top: 0.5rem; font-size: 0.8rem; color: #ffd700;">Vista previa</div>
                            </div>
                        </div>
                        
                        <!-- URL externa -->
                        <div id="urlUploadSection" style="display: none;">
                            <input type="url" id="fotoPerfil" name="fotoPerfil" placeholder="https://ejemplo.com/mi-foto.jpg" style="width: 100%; padding: 0.8rem; border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 6px; background: rgba(0,0,0,0.3); color: inherit; font-size: 1rem;">
                            <small style="opacity: 0.7; font-size: 0.8rem; display: block; margin-top: 0.5rem;">
                                üì∑ URL directa de tu foto (.jpg, .png, .gif)<br>
                                üí° Puedes usar servicios como Imgur, Discord, o cualquier enlace p√∫blico
                            </small>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="discord">ID Discord:</label>
                        <input type="text" id="discord" name="discord" placeholder="Ejemplo: usuario#1234" required>
                    </div>
                    <button type="submit" class="submit-btn">Registrar Miembro</button>
                </form>
            </div>
        </div>

        <!-- P√ÅGINA MIEMBROS -->
        <div id="miembros" class="page">
            <h2 style="color: #ffd700; text-align: center; margin-bottom: 2rem;">Miembros de la Compa√±√≠a</h2>
            <div class="empty-state">
                <div class="empty-state-icon">üë•</div>
                <div>No hay miembros registrados a√∫n</div>
                <div style="margin-top: 1rem; font-size: 1rem; opacity: 0.8;">
                    ¬°S√© el primero en unirte a la Compa√±√≠a Maldita 67!
                </div>
            </div>
        </div>

        <!-- P√ÅGINA EVENTOS -->
        <div id="formaciones" class="page">
            <h2 style="color: #ffd700; text-align: center; margin-bottom: 2rem;">üìÖ Eventos y Formaciones de la Compa√±√≠a</h2>
            
            <!-- Formulario para crear eventos -->
            <div class="form-container" style="margin-bottom: 2rem;">
                <h3 style="color: #ffd700; text-align: center; margin-bottom: 1.5rem;">Crear Nuevo Evento</h3>
                <form id="eventForm">
                    <div class="form-group">
                        <label for="eventTitle">T√≠tulo del Evento:</label>
                        <input type="text" id="eventTitle" name="eventTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="eventDate">Fecha:</label>
                        <input type="date" id="eventDate" name="eventDate" required>
                    </div>
                    <div class="form-group">
                        <label for="eventTime">Hora:</label>
                        <input type="time" id="eventTime" name="eventTime" required>
                    </div>
                    <div class="form-group">
                        <label for="eventType">Tipo de Evento:</label>
                        <select id="eventType" name="eventType" required>
                            <option value="">Seleccionar tipo...</option>
                            <option value="Misi√≥n">üéØ Misi√≥n</option>
                            <option value="Entrenamiento">üèãÔ∏è Entrenamiento</option>
                            <option value="Reuni√≥n">üë• Reuni√≥n</option>
                            <option value="Ceremonia">üéñÔ∏è Ceremonia</option>
                            <option value="Operaci√≥n Especial">‚ö° Operaci√≥n Especial</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="eventDescription">Descripci√≥n:</label>
                        <textarea id="eventDescription" name="eventDescription" rows="3" required></textarea>
                    </div>
                    <button type="submit" class="submit-btn">Crear Evento</button>
                </form>
            </div>
            
            <!-- Lista de eventos -->
            <div id="eventsList">
                <div class="empty-state">
                    <div class="empty-state-icon">üìÖ</div>
                    <div>No hay eventos programados</div>
                    <div style="margin-top: 1rem; font-size: 1rem; opacity: 0.8;">
                        ¬°Crea el primer evento de la compa√±√≠a!
                    </div>
                </div>
            </div>
        </div>

        <!-- P√ÅGINA MULTIMEDIA -->
        <div id="multimedia" class="page">
            <h2 style="color: #ffd700; text-align: center; margin-bottom: 2rem;">üì∏ Multimedia - Misiones y Momentos</h2>
            
            <!-- Formulario para agregar multimedia -->
            <div class="form-container" style="margin-bottom: 2rem;">
                <h3 style="color: #ffd700; text-align: center; margin-bottom: 1.5rem;">Compartir Momento</h3>
                <form id="multimediaForm">
                    <div class="form-group">
                        <label for="postTitle">T√≠tulo del Post:</label>
                        <input type="text" id="postTitle" name="postTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="postType">Tipo de Contenido:</label>
                        <select id="postType" name="postType" required>
                            <option value="">Seleccionar tipo...</option>
                            <option value="Foto">üì∑ Foto</option>
                            <option value="Video">üé• Video</option>
                            <option value="Informaci√≥n">üìù Informaci√≥n</option>
                            <option value="Misi√≥n">üéØ Reporte de Misi√≥n</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="mediaContent">üìÅ Contenido Multimedia:</label>
                        
                        <!-- Selector de m√©todo -->
                        <div style="display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap;">
                            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; background: rgba(255, 215, 0, 0.1); padding: 0.5rem 1rem; border-radius: 6px; border: 2px solid rgba(255, 215, 0, 0.3);">
                                <input type="radio" name="mediaMethod" value="file" checked onchange="toggleMediaMethod('file')" style="margin: 0;">
                                üìÅ Subir Archivo
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; background: rgba(255, 215, 0, 0.1); padding: 0.5rem 1rem; border-radius: 6px; border: 2px solid rgba(255, 215, 0, 0.3);">
                                <input type="radio" name="mediaMethod" value="url" onchange="toggleMediaMethod('url')" style="margin: 0;">
                                üîó URL Externa
                            </label>
                        </div>
                        
                        <!-- Subir archivo -->
                        <div id="mediaFileUploadSection">
                            <input type="file" id="mediaFile" name="mediaFile" accept="image/*,video/*" onchange="handleMediaFileSelect(this)" style="width: 100%; padding: 0.8rem; border: 2px dashed rgba(255, 215, 0, 0.5); border-radius: 6px; background: rgba(0,0,0,0.3); color: inherit; font-size: 1rem; cursor: pointer;">
                            <small style="opacity: 0.7; font-size: 0.8rem; display: block; margin-top: 0.5rem;">
                                üì∑ Im√°genes: .jpg, .png, .gif, .webp (m√°x. 10MB)<br>
                                üé• Videos: .mp4, .webm, .mov, .avi (m√°x. 50MB)<br>
                                üí° Los archivos se guardan localmente en tu navegador
                            </small>
                            
                            <!-- Vista previa multimedia -->
                            <div id="mediaPreview" style="display: none; margin-top: 1rem; text-align: center;">
                                <div style="display: inline-block; position: relative; max-width: 300px;">
                                    <div id="mediaPreviewContent"></div>
                                    <button type="button" onclick="clearMediaPreview()" style="position: absolute; top: -5px; right: -5px; width: 30px; height: 30px; border-radius: 50%; background: #dc3545; color: white; border: none; cursor: pointer; font-size: 1rem; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">‚úï</button>
                                </div>
                                <div id="mediaPreviewInfo" style="margin-top: 0.5rem; font-size: 0.8rem; color: #ffd700;"></div>
                            </div>
                        </div>
                        
                        <!-- URL externa -->
                        <div id="mediaUrlUploadSection" style="display: none;">
                            <input type="url" id="mediaUrl" name="mediaUrl" placeholder="https://ejemplo.com/imagen.jpg o https://youtube.com/watch?v=...">
                            <small style="opacity: 0.7; font-size: 0.8rem; display: block; margin-top: 0.5rem;">
                                üì∑ Para im√°genes: URL directa (.jpg, .png, .gif)<br>
                                üé• Para videos: YouTube, Vimeo, o URL directa
                            </small>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="postDescription">Descripci√≥n:</label>
                        <textarea id="postDescription" name="postDescription" rows="4" required placeholder="Describe tu momento, misi√≥n o informaci√≥n..."></textarea>
                    </div>
                    <button type="submit" class="submit-btn">Publicar</button>
                </form>
            </div>
            
            <!-- Feed de multimedia -->
            <div id="multimediaFeed">
                <div class="empty-state">
                    <div class="empty-state-icon">üì∑</div>
                    <div>No hay momentos compartidos</div>
                    <div style="margin-top: 1rem; font-size: 1rem; opacity: 0.8;">
                        ¬°Comparte el primer momento de la compa√±√≠a!
                    </div>
                </div>
            </div>
        </div>

        <!-- P√ÅGINA INFORMACI√ìN GENERAL -->
        <div id="informacion" class="page">
            <div class="form-container">
                <h2 style="color: #ffd700; text-align: center; margin-bottom: 2rem;">Informaci√≥n General</h2>
                
                <div style="display: grid; gap: 2rem;">
                    <div>
                        <h3 style="color: #ffd700;">Historia de la Compa√±√≠a</h3>
                        <p>La Compa√±√≠a Maldita 67 fue fundada como una unidad de √©lite especializada en misiones de paz y operaciones humanitarias. Con experiencias en m√∫ltiples situaciones de combate, hemos participado en numerosas operaciones internacionales para proteger a civiles y mantener la estabilidad en zonas de conflicto.</p>
                    </div>
                    
                    <div>
                        <h3 style="color: #ffd700;">Valores Fundamentales</h3>
                        <ul>
                            <li><strong>Honor:</strong> Actuar con integridad y respeto</li>
                            <li><strong>Valor:</strong> Enfrentar los desaf√≠os con coraje</li>
                            <li><strong>Disciplina:</strong> Mantener los m√°s altos est√°ndares</li>
                            <li><strong>Lealtad:</strong> Compromiso con la unidad y la misi√≥n</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h3 style="color: #ffd700;">Contacto</h3>
                        <p><strong>Cuartel General:</strong> Base Militar Clasificada</p>
                        <p><strong>Comandante:</strong> [Informaci√≥n Clasificada]</p>
                        <p><strong>Comunicaciones:</strong> Canal Militar Seguro</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Variables globales
        let members = [];
        let multimediaContent = [];
        let events = [];

        // Pa√≠ses con sus c√≥digos de bandera
        const countries = {
            'Espa√±a': 'üá™üá∏',
            'Francia': 'üá´üá∑',
            'Italia': 'üáÆüáπ',
            'Portugal': 'üáµüáπ',
            'M√©xico': 'üá≤üáΩ',
            'Argentina': 'üá¶üá∑',
            'Colombia': 'üá®üá¥',
            'Brasil': 'üáßüá∑',
            'Chile': 'üá®üá±',
            'Per√∫': 'üáµüá™',
            'Venezuela': 'üáªüá™',
            'Estados Unidos': 'üá∫üá∏',
            'Reino Unido': 'üá¨üáß',
            'Alemania': 'üá©üá™',
            'Canad√°': 'üá®üá¶'
        };

        // ========== SISTEMA DE GUARDADO AUTOM√ÅTICO S√öPER AVANZADO ==========
        
        let autoSaveTimeout = null;
        let lastSaveTime = Date.now();
        let saveQueue = [];
        let isSaving = false;
        let visitCount = 0;
        let sessionId = Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        let totalUsers = 0;
        let totalPosts = 0;
        let totalEvents = 0;
        
        // Funci√≥n universal de auto-guardado MEJORADA Y PERMANENTE
        function autoSave(reason = 'autom√°tico') {
            return new Promise((resolve, reject) => {
                try {
                    // Evitar guardados simult√°neos
                    if (isSaving) {
                        saveQueue.push({ reason, resolve, reject });
                        return;
                    }
                    
                    isSaving = true;
                    
                    // Incrementar contador de visitas solo para nuevas visitas
                    if (reason === 'visita' || reason === 'carga_inicial') {
                        visitCount++;
                    }
                    
                    // Actualizar contadores totales
                    totalUsers = members.length;
                    totalPosts = multimediaContent.length;
                    totalEvents = events.length;
                    
                    // Preparar datos completos con M√öLTIPLES BACKUPS
                    const saveData = {
                        members: members,
                        multimedia: multimediaContent,
                        events: events,
                        theme: document.body.classList.contains('day-mode') ? 'day' : 'night',
                        lastSave: Date.now(),
                        visitCount: visitCount,
                        sessionId: sessionId,
                        totalUsers: totalUsers,
                        totalPosts: totalPosts,
                        totalEvents: totalEvents,
                        version: '3.0',
                        lastUpdate: new Date().toISOString()
                    };
                    
                    // GUARDADO M√öLTIPLE PARA M√ÅXIMA SEGURIDAD
                    
                    // 1. Guardado principal
                    localStorage.setItem('compania67_members', JSON.stringify(saveData.members));
                    localStorage.setItem('compania67_multimedia', JSON.stringify(saveData.multimedia));
                    localStorage.setItem('compania67_events', JSON.stringify(saveData.events));
                    localStorage.setItem('compania67_theme', saveData.theme);
                    localStorage.setItem('compania67_lastSave', saveData.lastSave.toString());
                    localStorage.setItem('compania67_visitCount', saveData.visitCount.toString());
                    localStorage.setItem('compania67_sessionId', saveData.sessionId);
                    localStorage.setItem('compania67_version', saveData.version);
                    localStorage.setItem('compania67_totalUsers', saveData.totalUsers.toString());
                    localStorage.setItem('compania67_totalPosts', saveData.totalPosts.toString());
                    localStorage.setItem('compania67_totalEvents', saveData.totalEvents.toString());
                    localStorage.setItem('compania67_lastUpdate', saveData.lastUpdate);
                    
                    // 2. Backup de seguridad diario
                    const backupKey = 'compania67_backup_' + new Date().toISOString().split('T')[0];
                    localStorage.setItem(backupKey, JSON.stringify(saveData));
                    
                    // 3. Backup de emergencia (siempre actualizado)
                    localStorage.setItem('compania67_emergency_backup', JSON.stringify(saveData));
                    
                    // 4. Backup por hora (para recuperaci√≥n)
                    const hourlyBackupKey = 'compania67_hourly_' + new Date().getHours();
                    localStorage.setItem(hourlyBackupKey, JSON.stringify(saveData));
                    
                    // 5. Contador global de guardados
                    const saveCount = parseInt(localStorage.getItem('compania67_saveCount') || '0') + 1;
                    localStorage.setItem('compania67_saveCount', saveCount.toString());
                    
                    lastSaveTime = Date.now();
                    
                    // Mostrar indicador de guardado personalizado con estad√≠sticas
                    const messages = {
                        'registro': `‚úÖ Usuario #${totalUsers} registrado y guardado permanentemente`,
                        'evento': `‚úÖ Evento creado - Total: ${totalEvents} eventos guardados`,
                        'multimedia': `‚úÖ Post publicado - Total: ${totalPosts} posts guardados`,
                        'autom√°tico': `üíæ Auto-guardado: ${totalUsers} usuarios, ${totalPosts} posts, ${totalEvents} eventos`,
                        'visita': `üéØ Visita #${visitCount} - Datos cargados: ${totalUsers} usuarios registrados`,
                        'carga_inicial': `üöÄ Sistema cargado - ${totalUsers} usuarios, ${totalPosts} posts, ${totalEvents} eventos`,
                        'tema': `üé® Tema guardado - ${totalUsers} usuarios activos`,
                        'seguridad_1m': `üîí Backup de seguridad - ${totalUsers} usuarios protegidos`,
                        'backup_5m': `üíæ Backup completo - Todos los datos seguros`
                    };
                    
                    showSaveIndicator(messages[reason] || `‚úÖ Guardado: ${reason} - ${totalUsers} usuarios activos`);
                    
                    console.log(`üîÑ Auto-guardado PERMANENTE [${reason}]:`, {
                        members: saveData.members.length,
                        multimedia: saveData.multimedia.length,
                        events: saveData.events.length,
                        visitCount: visitCount,
                        totalUsers: totalUsers,
                        totalPosts: totalPosts,
                        totalEvents: totalEvents,
                        saveCount: saveCount,
                        sessionId: sessionId,
                        time: new Date().toLocaleTimeString(),
                        backups: ['principal', 'diario', 'emergencia', 'por_hora']
                    });
                    
                    isSaving = false;
                    
                    // Actualizar estad√≠sticas en tiempo real
                    updateLiveStats();
                    
                    resolve(saveData);
                    
                    // Procesar cola de guardado
                    if (saveQueue.length > 0) {
                        const next = saveQueue.shift();
                        autoSave(next.reason).then(next.resolve).catch(next.reject);
                    }
                    
                } catch (e) {
                    isSaving = false;
                    console.error('‚ùå Error en auto-guardado:', e);
                    showSaveIndicator('‚ùå Error al guardar - Reintentando...', true);
                    
                    // Reintentar guardado despu√©s de 2 segundos
                    setTimeout(() => {
                        autoSave(reason + '_retry').then(resolve).catch(reject);
                    }, 2000);
                }
            });
        }
        
        // Guardado inmediato MEJORADO
        function saveNow(reason = 'inmediato') {
            // Cancelar guardado pendiente
            if (autoSaveTimeout) {
                clearTimeout(autoSaveTimeout);
            }
            
            // Guardar inmediatamente
            return autoSave(reason);
        }
        
        // Guardado inteligente con detecci√≥n de cambios
        function smartSave(reason = 'cambio') {
            // Verificar si hay cambios reales
            try {
                const currentData = {
                    members: JSON.stringify(members),
                    multimedia: JSON.stringify(multimediaContent),
                    events: JSON.stringify(events)
                };
                
                const savedMembers = localStorage.getItem('compania67_members') || '[]';
                const savedMultimedia = localStorage.getItem('compania67_multimedia') || '[]';
                const savedEvents = localStorage.getItem('compania67_events') || '[]';
                
                // Solo guardar si hay cambios
                if (currentData.members !== savedMembers || 
                    currentData.multimedia !== savedMultimedia || 
                    currentData.events !== savedEvents) {
                    return saveNow(reason);
                } else {
                    console.log('üìä Sin cambios detectados, guardado omitido');
                    return Promise.resolve();
                }
            } catch (e) {
                // En caso de error, guardar por seguridad
                return saveNow(reason);
            }
        }
        
        // Actualizar estad√≠sticas en tiempo real
        function updateLiveStats() {
            const statsElement = document.getElementById('liveStats');
            if (statsElement) {
                statsElement.innerHTML = `üë• ${totalUsers} | üì∑ ${totalPosts} | üìÖ ${totalEvents}`;
                statsElement.title = `${totalUsers} usuarios registrados, ${totalPosts} posts multimedia, ${totalEvents} eventos programados`;
            }
        }

        // Mostrar indicador visual de guardado
        function showSaveIndicator(message, isError = false) {
            // Remover indicador anterior si existe
            const existingIndicator = document.getElementById('saveIndicator');
            if (existingIndicator) {
                existingIndicator.remove();
            }
            
            // Crear nuevo indicador
            const indicator = document.createElement('div');
            indicator.id = 'saveIndicator';
            indicator.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${isError ? 'linear-gradient(45deg, #dc3545, #c82333)' : 'linear-gradient(45deg, #28a745, #20c997)'};
                color: white;
                padding: 0.8rem 1.5rem;
                border-radius: 25px;
                font-weight: bold;
                font-size: 0.9rem;
                z-index: 10000;
                box-shadow: 0 4px 15px rgba(0,0,0,0.3);
                transform: translateX(100%);
                transition: all 0.3s ease;
                border: 2px solid ${isError ? '#dc3545' : '#28a745'};
            `;
            indicator.textContent = message;
            
            document.body.appendChild(indicator);
            
            // Animar entrada
            setTimeout(() => {
                indicator.style.transform = 'translateX(0)';
            }, 10);
            
            // Animar salida y remover
            setTimeout(() => {
                indicator.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (indicator.parentNode) {
                        indicator.parentNode.removeChild(indicator);
                    }
                }, 300);
            }, isError ? 4000 : 2000);
        }

        // Cargar TODOS los datos al iniciar CON RECUPERACI√ìN AUTOM√ÅTICA
        function loadAllData() {
            try {
                console.log('üîÑ Iniciando carga de datos con recuperaci√≥n autom√°tica...');
                
                // Funci√≥n para intentar cargar desde m√∫ltiples fuentes
                function loadWithFallback(key, fallbackKeys = []) {
                    let data = localStorage.getItem(key);
                    
                    // Si no hay datos principales, intentar backups
                    if (!data || data === 'null' || data === '[]') {
                        console.log(`‚ö†Ô∏è Datos principales no encontrados para ${key}, intentando backups...`);
                        
                        for (const fallbackKey of fallbackKeys) {
                            const fallbackData = localStorage.getItem(fallbackKey);
                            if (fallbackData && fallbackData !== 'null' && fallbackData !== '[]') {
                                console.log(`‚úÖ Datos recuperados desde backup: ${fallbackKey}`);
                                
                                // Si es un backup completo, extraer la parte espec√≠fica
                                if (fallbackKey.includes('backup') || fallbackKey.includes('emergency')) {
                                    try {
                                        const backupObj = JSON.parse(fallbackData);
                                        if (key.includes('members') && backupObj.members) {
                                            return JSON.stringify(backupObj.members);
                                        }
                                        if (key.includes('multimedia') && backupObj.multimedia) {
                                            return JSON.stringify(backupObj.multimedia);
                                        }
                                        if (key.includes('events') && backupObj.events) {
                                            return JSON.stringify(backupObj.events);
                                        }
                                    } catch (e) {
                                        console.log(`‚ùå Error procesando backup ${fallbackKey}:`, e);
                                        continue;
                                    }
                                } else {
                                    return fallbackData;
                                }
                            }
                        }
                    }
                    
                    return data;
                }
                
                // Cargar contador de visitas
                const savedVisitCount = localStorage.getItem('compania67_visitCount');
                if (savedVisitCount) {
                    visitCount = parseInt(savedVisitCount);
                } else {
                    visitCount = 0;
                }
                
                // Cargar contadores totales
                totalUsers = parseInt(localStorage.getItem('compania67_totalUsers') || '0');
                totalPosts = parseInt(localStorage.getItem('compania67_totalPosts') || '0');
                totalEvents = parseInt(localStorage.getItem('compania67_totalEvents') || '0');
                
                // Cargar miembros con fallback
                const savedMembers = loadWithFallback('compania67_members', [
                    'compania67_emergency_backup',
                    'compania67_backup_' + new Date().toISOString().split('T')[0],
                    'compania67_hourly_' + new Date().getHours(),
                    'compania67_hourly_' + ((new Date().getHours() - 1 + 24) % 24)
                ]);
                
                if (savedMembers && savedMembers !== '[]') {
                    members = JSON.parse(savedMembers);
                    console.log('‚úÖ Miembros cargados:', members.length);
                } else {
                    members = [];
                    console.log('‚ÑπÔ∏è No hay miembros guardados, iniciando con lista vac√≠a');
                }
                
                // Cargar multimedia con fallback
                const savedMultimedia = loadWithFallback('compania67_multimedia', [
                    'compania67_emergency_backup',
                    'compania67_backup_' + new Date().toISOString().split('T')[0],
                    'compania67_hourly_' + new Date().getHours(),
                    'compania67_hourly_' + ((new Date().getHours() - 1 + 24) % 24)
                ]);
                
                if (savedMultimedia && savedMultimedia !== '[]') {
                    multimediaContent = JSON.parse(savedMultimedia);
                    console.log('‚úÖ Multimedia cargado:', multimediaContent.length);
                } else {
                    multimediaContent = [];
                    console.log('‚ÑπÔ∏è No hay multimedia guardado, iniciando con lista vac√≠a');
                }
                
                // Cargar eventos con fallback
                const savedEvents = loadWithFallback('compania67_events', [
                    'compania67_emergency_backup',
                    'compania67_backup_' + new Date().toISOString().split('T')[0],
                    'compania67_hourly_' + new Date().getHours(),
                    'compania67_hourly_' + ((new Date().getHours() - 1 + 24) % 24)
                ]);
                
                if (savedEvents && savedEvents !== '[]') {
                    events = JSON.parse(savedEvents);
                    console.log('‚úÖ Eventos cargados:', events.length);
                } else {
                    events = [];
                    console.log('‚ÑπÔ∏è No hay eventos guardados, iniciando con lista vac√≠a');
                }
                
                // Actualizar contadores reales
                totalUsers = members.length;
                totalPosts = multimediaContent.length;
                totalEvents = events.length;
                
                // Cargar tema
                const savedTheme = localStorage.getItem('compania67_theme');
                if (savedTheme === 'day') {
                    document.body.classList.remove('night-mode');
                    document.body.classList.add('day-mode');
                    document.getElementById('themeBtn').innerHTML = '‚òÄÔ∏è Modo Noche';
                }
                
                // Informaci√≥n de carga
                const lastSave = localStorage.getItem('compania67_lastSave');
                const lastUpdate = localStorage.getItem('compania67_lastUpdate');
                const saveCount = localStorage.getItem('compania67_saveCount') || '0';
                
                console.log('üéØ TODOS los datos cargados exitosamente:', {
                    members: members.length,
                    multimedia: multimediaContent.length,
                    events: events.length,
                    visitCount: visitCount,
                    totalUsers: totalUsers,
                    totalPosts: totalPosts,
                    totalEvents: totalEvents,
                    theme: savedTheme || 'night',
                    lastSave: lastSave ? new Date(parseInt(lastSave)).toLocaleString() : 'Nunca',
                    lastUpdate: lastUpdate || 'Desconocido',
                    saveCount: saveCount
                });
                
                // Actualizar estad√≠sticas despu√©s de cargar
                updateLiveStats();
                
                // Guardar inmediatamente al cargar (nueva visita)
                saveNow('carga_inicial');
                
                return true;
            } catch (e) {
                console.error('‚ùå Error cargando datos:', e);
                
                // Intentar recuperaci√≥n de emergencia
                try {
                    console.log('üö® Intentando recuperaci√≥n de emergencia...');
                    const emergencyBackup = localStorage.getItem('compania67_emergency_backup');
                    if (emergencyBackup) {
                        const backupData = JSON.parse(emergencyBackup);
                        members = backupData.members || [];
                        multimediaContent = backupData.multimedia || [];
                        events = backupData.events || [];
                        visitCount = backupData.visitCount || 0;
                        totalUsers = members.length;
                        totalPosts = multimediaContent.length;
                        totalEvents = events.length;
                        
                        console.log('‚úÖ Datos recuperados desde backup de emergencia');
                        updateLiveStats();
                        showSaveIndicator('üö® Datos recuperados desde backup de emergencia', false);
                        return true;
                    }
                } catch (recoveryError) {
                    console.error('‚ùå Error en recuperaci√≥n de emergencia:', recoveryError);
                }
                
                // Inicializar datos vac√≠os en caso de error total
                members = [];
                multimediaContent = [];
                events = [];
                visitCount = 0;
                totalUsers = 0;
                totalPosts = 0;
                totalEvents = 0;
                
                console.log('‚ö†Ô∏è Iniciando con datos vac√≠os debido a errores de carga');
                updateLiveStats();
                showSaveIndicator('‚ö†Ô∏è Sistema iniciado con datos vac√≠os', true);
                return false;
            }
        }

        // Funciones individuales de carga (para compatibilidad)
        function loadMembers() {
            try {
                const saved = localStorage.getItem('compania67_members');
                if (saved) {
                    members = JSON.parse(saved);
                    console.log('‚úÖ Miembros recargados:', members.length);
                } else {
                    members = [];
                }
            } catch (e) {
                console.error('‚ùå Error cargando miembros:', e);
                members = [];
            }
        }

        function loadMultimedia() {
            try {
                const saved = localStorage.getItem('compania67_multimedia');
                if (saved) {
                    multimediaContent = JSON.parse(saved);
                    console.log('‚úÖ Multimedia recargado:', multimediaContent.length);
                } else {
                    multimediaContent = [];
                }
            } catch (e) {
                console.error('‚ùå Error cargando multimedia:', e);
                multimediaContent = [];
            }
        }

        function loadEvents() {
            try {
                const saved = localStorage.getItem('compania67_events');
                if (saved) {
                    events = JSON.parse(saved);
                    console.log('‚úÖ Eventos recargados:', events.length);
                } else {
                    events = [];
                }
            } catch (e) {
                console.error('‚ùå Error cargando eventos:', e);
                events = [];
            }
        }

        function loadTheme() {
            try {
                const savedTheme = localStorage.getItem('compania67_theme');
                if (savedTheme === 'day') {
                    document.body.classList.remove('night-mode');
                    document.body.classList.add('day-mode');
                    document.getElementById('themeBtn').innerHTML = '‚òÄÔ∏è Modo Noche';
                }
                console.log('‚úÖ Tema recargado:', savedTheme || 'night');
            } catch (e) {
                console.error('‚ùå Error cargando tema:', e);
            }
        }
        
        // Verificar integridad de datos
        function checkDataIntegrity() {
            try {
                const lastSave = localStorage.getItem('compania67_lastSave');
                if (lastSave) {
                    const timeSinceLastSave = Date.now() - parseInt(lastSave);
                    const minutesSinceLastSave = Math.floor(timeSinceLastSave / (1000 * 60));
                    
                    if (minutesSinceLastSave > 0) {
                        console.log(`üìä √öltimo guardado hace ${minutesSinceLastSave} minuto(s)`);
                    }
                }
                
                // Verificar que los datos sean v√°lidos
                if (!Array.isArray(members)) members = [];
                if (!Array.isArray(multimediaContent)) multimediaContent = [];
                if (!Array.isArray(events)) events = [];
                
                return true;
            } catch (e) {
                console.error('‚ùå Error verificando integridad:', e);
                return false;
            }
        }

        // ========== FUNCIONES DE NAVEGACI√ìN ==========
        
        // Funci√≥n principal de navegaci√≥n
        function showPage(pageId) {
            // Ocultar todas las p√°ginas
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Mostrar p√°gina seleccionada
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
            }
            
            // Actualizar navegaci√≥n activa
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Activar enlace correspondiente
            const activeLink = document.querySelector(`[onclick="showPage('${pageId}')"]`);
            if (activeLink) {
                activeLink.classList.add('active');
            }
            
            // Cargar contenido espec√≠fico de la p√°gina
            if (pageId === 'miembros') {
                displayMembers();
            } else if (pageId === 'multimedia') {
                displayMultimedia();
            } else if (pageId === 'formaciones') {
                displayEvents();
            }
            
            console.log(`Navegando a: ${pageId}`);
        }

        // ========== FUNCIONES DE MIEMBROS ==========
        
        // Editar miembro
        function editMember(memberId) {
            const member = members.find(m => m.id === memberId);
            if (!member) {
                alert('Miembro no encontrado');
                return;
            }
            
            // Crear modal de edici√≥n
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                padding: 2rem;
                overflow-y: auto;
            `;
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #2d4a2b, #3d5a3b); padding: 2rem; border-radius: 12px; border: 2px solid #ffd700; max-width: 600px; width: 100%; max-height: 90vh; overflow-y: auto; color: #e8f5e8;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 style="color: #ffd700; margin: 0;">‚úèÔ∏è Editar Perfil de ${member.name}</h2>
                        <button onclick="closeEditModal()" style="background: #dc3545; color: white; border: none; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center;">‚úï</button>
                    </div>
                    
                    <form id="editMemberForm">
                        <div style="display: grid; gap: 1.5rem;">
                            <div>
                                <label style="display: block; color: #ffd700; margin-bottom: 0.5rem; font-weight: bold;">Nombre:</label>
                                <input type="text" id="editNombre" value="${member.name}" required style="width: 100%; padding: 0.8rem; border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 6px; background: rgba(0,0,0,0.3); color: #e8f5e8; font-size: 1rem;">
                            </div>
                            
                            <div>
                                <label style="display: block; color: #ffd700; margin-bottom: 0.5rem; font-weight: bold;">Edad:</label>
                                <input type="number" id="editEdad" value="${member.age}" min="18" max="65" required style="width: 100%; padding: 0.8rem; border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 6px; background: rgba(0,0,0,0.3); color: #e8f5e8; font-size: 1rem;">
                            </div>
                            
                            <div>
                                <label style="display: block; color: #ffd700; margin-bottom: 0.5rem; font-weight: bold;">Nacionalidad:</label>
                                <select id="editNacionalidad" required style="width: 100%; padding: 0.8rem; border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 6px; background: rgba(0,0,0,0.3); color: #e8f5e8; font-size: 1rem;">
                                    <option value="Espa√±a" ${member.nationality === 'Espa√±a' ? 'selected' : ''}>üá™üá∏ Espa√±a</option>
                                    <option value="Francia" ${member.nationality === 'Francia' ? 'selected' : ''}>üá´üá∑ Francia</option>
                                    <option value="Italia" ${member.nationality === 'Italia' ? 'selected' : ''}>üáÆüáπ Italia</option>
                                    <option value="Portugal" ${member.nationality === 'Portugal' ? 'selected' : ''}>üáµüáπ Portugal</option>
                                    <option value="M√©xico" ${member.nationality === 'M√©xico' ? 'selected' : ''}>üá≤üáΩ M√©xico</option>
                                    <option value="Argentina" ${member.nationality === 'Argentina' ? 'selected' : ''}>üá¶üá∑ Argentina</option>
                                    <option value="Colombia" ${member.nationality === 'Colombia' ? 'selected' : ''}>üá®üá¥ Colombia</option>
                                    <option value="Brasil" ${member.nationality === 'Brasil' ? 'selected' : ''}>üáßüá∑ Brasil</option>
                                </select>
                            </div>
                            
                            <div>
                                <label style="display: block; color: #ffd700; margin-bottom: 0.5rem; font-weight: bold;">üéñÔ∏è Rango:</label>
                                <select id="editRango" required style="width: 100%; padding: 0.8rem; border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 6px; background: rgba(0,0,0,0.3); color: #e8f5e8; font-size: 1rem;">
                                    <option value="Infanter√≠a" ${member.rank === 'Infanter√≠a' ? 'selected' : ''}>Infanter√≠a</option>
                                    <option value="Soldado" ${member.rank === 'Soldado' ? 'selected' : ''}>Soldado</option>
                                    <option value="Soldado Primero" ${member.rank === 'Soldado Primero' ? 'selected' : ''}>Soldado Primero</option>
                                    <option value="Cabo" ${member.rank === 'Cabo' ? 'selected' : ''}>Cabo</option>
                                    <option value="Cabo Primero" ${member.rank === 'Cabo Primero' ? 'selected' : ''}>Cabo Primero</option>
                                    <option value="Sargento" ${member.rank === 'Sargento' ? 'selected' : ''}>Sargento</option>
                                    <option value="Sargento Primero" ${member.rank === 'Sargento Primero' ? 'selected' : ''}>Sargento Primero</option>
                                    <option value="Teniente" ${member.rank === 'Teniente' ? 'selected' : ''}>Teniente</option>
                                    <option value="Teniente Primero" ${member.rank === 'Teniente Primero' ? 'selected' : ''}>Teniente Primero</option>
                                    <option value="Capit√°n" ${member.rank === 'Capit√°n' ? 'selected' : ''}>Capit√°n</option>
                                </select>
                            </div>
                            
                            <div>
                                <label style="display: block; color: #ffd700; margin-bottom: 0.5rem; font-weight: bold;">‚öîÔ∏è Especialidad:</label>
                                <select id="editEspecialidad" required style="width: 100%; padding: 0.8rem; border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 6px; background: rgba(0,0,0,0.3); color: #e8f5e8; font-size: 1rem;">
                                    <option value="Infanter√≠a" ${member.specialty === 'Infanter√≠a' ? 'selected' : ''}>Infanter√≠a</option>
                                    <option value="Artiller√≠a" ${member.specialty === 'Artiller√≠a' ? 'selected' : ''}>Artiller√≠a</option>
                                    <option value="Ingenieros" ${member.specialty === 'Ingenieros' ? 'selected' : ''}>Ingenieros</option>
                                    <option value="Comunicaciones" ${member.specialty === 'Comunicaciones' ? 'selected' : ''}>Comunicaciones</option>
                                    <option value="M√©dico" ${member.specialty === 'M√©dico' ? 'selected' : ''}>M√©dico</option>
                                </select>
                            </div>
                            
                            <div>
                                <label style="display: block; color: #ffd700; margin-bottom: 0.5rem; font-weight: bold;">üí¨ ID Discord:</label>
                                <input type="text" id="editDiscord" value="${member.discord}" required style="width: 100%; padding: 0.8rem; border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 6px; background: rgba(0,0,0,0.3); color: #e8f5e8; font-size: 1rem;">
                            </div>
                            
                            <div>
                                <label style="display: block; color: #ffd700; margin-bottom: 0.5rem; font-weight: bold;">üñºÔ∏è Foto de Perfil:</label>
                                
                                <!-- Selector de m√©todo -->
                                <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; background: rgba(255, 215, 0, 0.1); padding: 0.5rem 1rem; border-radius: 6px; border: 2px solid rgba(255, 215, 0, 0.3);">
                                        <input type="radio" name="editPhotoMethod" value="file" ${member.photoMethod === 'file' ? 'checked' : ''} onchange="toggleEditPhotoMethod('file')" style="margin: 0;">
                                        üìÅ Subir Archivo
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; background: rgba(255, 215, 0, 0.1); padding: 0.5rem 1rem; border-radius: 6px; border: 2px solid rgba(255, 215, 0, 0.3);">
                                        <input type="radio" name="editPhotoMethod" value="url" ${member.photoMethod === 'url' ? 'checked' : ''} onchange="toggleEditPhotoMethod('url')" style="margin: 0;">
                                        üîó URL Externa
                                    </label>
                                </div>
                                
                                <!-- Subir archivo -->
                                <div id="editFileUploadSection" style="display: ${member.photoMethod === 'file' ? 'block' : 'none'};">
                                    <input type="file" id="editFotoPerfilFile" accept="image/*" onchange="handleEditFileSelect(this)" style="width: 100%; padding: 0.8rem; border: 2px dashed rgba(255, 215, 0, 0.5); border-radius: 6px; background: rgba(0,0,0,0.3); color: inherit; font-size: 1rem; cursor: pointer;">
                                    <small style="opacity: 0.7; font-size: 0.8rem; display: block; margin-top: 0.5rem;">
                                        üì∑ Selecciona una nueva imagen o mant√©n la actual
                                    </small>
                                    
                                    <!-- Vista previa -->
                                    <div id="editImagePreview" style="display: ${member.profilePhoto && member.photoMethod === 'file' ? 'block' : 'none'}; margin-top: 1rem; text-align: center;">
                                        <div style="display: inline-block; position: relative;">
                                            <img id="editPreviewImg" src="${member.profilePhoto || ''}" style="width: 100px; height: 100px; object-fit: cover; border-radius: 50%; border: 3px solid #ffd700; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);">
                                            <button type="button" onclick="clearEditImagePreview()" style="position: absolute; top: -5px; right: -5px; width: 25px; height: 25px; border-radius: 50%; background: #dc3545; color: white; border: none; cursor: pointer; font-size: 0.8rem; display: flex; align-items: center; justify-content: center;">‚úï</button>
                                        </div>
                                        <div style="margin-top: 0.5rem; font-size: 0.8rem; color: #ffd700;">Vista previa actual</div>
                                    </div>
                                </div>
                                
                                <!-- URL externa -->
                                <div id="editUrlUploadSection" style="display: ${member.photoMethod === 'url' ? 'block' : 'none'};">
                                    <input type="url" id="editFotoPerfil" value="${member.photoMethod === 'url' ? member.profilePhoto || '' : ''}" placeholder="https://ejemplo.com/mi-foto.jpg" style="width: 100%; padding: 0.8rem; border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 6px; background: rgba(0,0,0,0.3); color: inherit; font-size: 1rem;">
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                            <button type="button" onclick="closeEditModal()" style="flex: 1; background: #6c757d; color: white; border: none; padding: 1rem; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: bold;">
                                Cancelar
                            </button>
                            <button type="submit" style="flex: 1; background: linear-gradient(45deg, #28a745, #20c997); color: white; border: none; padding: 1rem; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: bold;">
                                üíæ Guardar Cambios
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Manejar env√≠o del formulario de edici√≥n
            document.getElementById('editMemberForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Obtener foto de perfil seg√∫n el m√©todo seleccionado
                let profilePhoto = member.profilePhoto; // Mantener la actual por defecto
                const photoMethod = document.querySelector('input[name="editPhotoMethod"]:checked').value;
                
                if (photoMethod === 'file') {
                    const previewImg = document.getElementById('editPreviewImg');
                    if (previewImg && previewImg.src && previewImg.src.startsWith('data:')) {
                        profilePhoto = previewImg.src;
                    }
                } else {
                    profilePhoto = document.getElementById('editFotoPerfil').value || null;
                }
                
                // Actualizar datos del miembro
                const memberIndex = members.findIndex(m => m.id === memberId);
                if (memberIndex !== -1) {
                    members[memberIndex] = {
                        ...member,
                        name: document.getElementById('editNombre').value,
                        age: parseInt(document.getElementById('editEdad').value),
                        nationality: document.getElementById('editNacionalidad').value,
                        rank: document.getElementById('editRango').value,
                        specialty: document.getElementById('editEspecialidad').value,
                        discord: document.getElementById('editDiscord').value,
                        profilePhoto: profilePhoto,
                        photoMethod: photoMethod,
                        lastModified: new Date().toISOString()
                    };
                    
                    // Guardar cambios
                    saveNow('edicion_miembro').then(() => {
                        showSaveIndicator(`‚úÖ Perfil de ${members[memberIndex].name} actualizado exitosamente`);
                        displayMembers(); // Actualizar vista
                        closeEditModal();
                    });
                }
            });
            
            // Funci√≥n para cerrar modal
            window.closeEditModal = function() {
                if (document.body.contains(modal)) {
                    document.body.removeChild(modal);
                }
                delete window.closeEditModal;
                delete window.toggleEditPhotoMethod;
                delete window.handleEditFileSelect;
                delete window.clearEditImagePreview;
            };
            
            // Funci√≥n para alternar m√©todo de foto en edici√≥n
            window.toggleEditPhotoMethod = function(method) {
                const fileSection = document.getElementById('editFileUploadSection');
                const urlSection = document.getElementById('editUrlUploadSection');
                
                if (method === 'file') {
                    fileSection.style.display = 'block';
                    urlSection.style.display = 'none';
                } else {
                    fileSection.style.display = 'none';
                    urlSection.style.display = 'block';
                    clearEditImagePreview();
                }
            };
            
            // Funci√≥n para manejar archivo en edici√≥n
            window.handleEditFileSelect = function(input) {
                const file = input.files[0];
                if (!file) {
                    return;
                }
                
                if (!file.type.startsWith('image/')) {
                    alert('Por favor selecciona un archivo de imagen v√°lido.');
                    input.value = '';
                    return;
                }
                
                const maxSize = 5 * 1024 * 1024;
                if (file.size > maxSize) {
                    alert('La imagen es demasiado grande. Por favor selecciona una imagen menor a 5MB.');
                    input.value = '';
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        let { width, height } = img;
                        const maxDimension = 800;
                        
                        if (width > maxDimension || height > maxDimension) {
                            if (width > height) {
                                height = (height * maxDimension) / width;
                                width = maxDimension;
                            } else {
                                width = (width * maxDimension) / height;
                                height = maxDimension;
                            }
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        const optimizedDataUrl = canvas.toDataURL('image/jpeg', 0.8);
                        showEditImagePreview(optimizedDataUrl, file.name);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            };
            
            // Funci√≥n para mostrar vista previa en edici√≥n
            function showEditImagePreview(dataUrl, fileName) {
                const preview = document.getElementById('editImagePreview');
                const previewImg = document.getElementById('editPreviewImg');
                
                preview.style.display = 'block';
                previewImg.src = dataUrl;
                preview.innerHTML = `
                    <div style="display: inline-block; position: relative;">
                        <img id="editPreviewImg" src="${dataUrl}" style="width: 100px; height: 100px; object-fit: cover; border-radius: 50%; border: 3px solid #ffd700; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);">
                        <button type="button" onclick="clearEditImagePreview()" style="position: absolute; top: -5px; right: -5px; width: 25px; height: 25px; border-radius: 50%; background: #dc3545; color: white; border: none; cursor: pointer; font-size: 0.8rem; display: flex; align-items: center; justify-content: center;">‚úï</button>
                    </div>
                    <div style="margin-top: 0.5rem; font-size: 0.8rem; color: #ffd700;">
                        ‚úÖ ${fileName || 'Nueva imagen'}<br>
                        <span style="opacity: 0.7; font-size: 0.7rem;">${(dataUrl.length / 1024).toFixed(1)}KB</span>
                    </div>
                `;
            }
            
            // Funci√≥n para limpiar vista previa en edici√≥n
            window.clearEditImagePreview = function() {
                const preview = document.getElementById('editImagePreview');
                const fileInput = document.getElementById('editFotoPerfilFile');
                
                preview.style.display = 'none';
                if (fileInput) {
                    fileInput.value = '';
                }
            };
        }
        
        // Eliminar miembro
        function deleteMember(memberId, memberName) {
            if (confirm(`¬øEst√°s seguro de que quieres eliminar a ${memberName} de la compa√±√≠a?`)) {
                if (confirm(`Esta acci√≥n eliminar√° permanentemente el perfil de ${memberName}. ¬øContinuar?`)) {
                    const memberIndex = members.findIndex(m => m.id === memberId);
                    if (memberIndex !== -1) {
                        members.splice(memberIndex, 1);
                        
                        saveNow('eliminacion_miembro').then(() => {
                            showSaveIndicator(`‚úÖ ${memberName} ha sido eliminado de la compa√±√≠a`);
                            displayMembers(); // Actualizar vista
                        });
                    }
                }
            }
        }
        
        // Mostrar miembros
        function displayMembers() {
            const membersContainer = document.querySelector('#miembros .empty-state').parentElement;
            
            if (members.length === 0) {
                membersContainer.innerHTML = `
                    <h2 style="color: #ffd700; text-align: center; margin-bottom: 2rem;">Miembros de la Compa√±√≠a</h2>
                    <div class="empty-state">
                        <div class="empty-state-icon">üë•</div>
                        <div>No hay miembros registrados a√∫n</div>
                        <div style="margin-top: 1rem; font-size: 1rem; opacity: 0.8;">
                            ¬°S√© el primero en unirte a la Compa√±√≠a Maldita 67!
                        </div>
                    </div>
                `;
                return;
            }

            let membersHTML = `
                <h2 style="color: #ffd700; text-align: center; margin-bottom: 2rem;">Miembros de la Compa√±√≠a</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;">
            `;

            members.forEach(member => {
                membersHTML += `
                    <div class="form-container" style="max-width: 300px; margin: 0; position: relative; transition: transform 0.3s ease; cursor: pointer;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                        <!-- Banderas en las esquinas -->
                        <div style="position: absolute; top: -10px; right: -10px; display: flex; gap: 5px; z-index: 10;">
                            <div style="width: 35px; height: 35px; border-radius: 50%; background: white; border: 3px solid #ffd700; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                                üá™üá∏
                            </div>
                            <div style="width: 35px; height: 35px; border-radius: 50%; background: white; border: 3px solid #ffd700; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                                ${countries[member.nationality] || 'üåç'}
                            </div>
                        </div>
                        
                        <!-- Avatar del miembro -->
                        <div style="text-align: center; margin-bottom: 1.5rem; padding-top: 1rem;">
                            <div style="width: 100px; height: 100px; border-radius: 50%; margin: 0 auto; border: 4px solid #ffd700; background: linear-gradient(45deg, #8b4513, #a0522d); color: #ffd700; font-weight: bold; font-size: 2rem; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3); overflow: hidden; position: relative;">
                                ${member.profilePhoto ? `
                                    <img src="${member.profilePhoto}" 
                                         alt="Foto de ${member.name}" 
                                         style="width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0;"
                                         onerror="this.style.display='none'; this.parentElement.innerHTML='${member.name.charAt(0)}';">
                                ` : member.name.charAt(0)}
                            </div>
                        </div>
                        
                        <!-- Informaci√≥n del miembro -->
                        <div style="text-align: center; margin-bottom: 1rem;">
                            <div style="font-size: 1.3rem; font-weight: bold; color: #ffd700; margin-bottom: 0.5rem;">
                                ${member.name}
                            </div>
                        </div>
                        
                        <!-- Datos del miembro -->
                        <div style="display: grid; gap: 0.8rem; margin-bottom: 1.5rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: rgba(0,0,0,0.2); border-radius: 6px;">
                                <span style="font-weight: bold;">üéÇ Edad:</span>
                                <span>${member.age} a√±os</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: rgba(0,0,0,0.2); border-radius: 6px;">
                                <span style="font-weight: bold;">üåç Pa√≠s:</span>
                                <span>${member.nationality}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: rgba(0,0,0,0.2); border-radius: 6px;">
                                <span style="font-weight: bold;">üéñÔ∏è Rango:</span>
                                <span style="background: linear-gradient(45deg, #8b4513, #a0522d); color: #ffd700; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.8rem; font-weight: bold; border: 1px solid #ffd700;">${member.rank}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: rgba(0,0,0,0.2); border-radius: 6px;">
                                <span style="font-weight: bold;">‚öîÔ∏è Especialidad:</span>
                                <span>${member.specialty}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: rgba(0,0,0,0.2); border-radius: 6px;">
                                <span style="font-weight: bold;">üí¨ Discord:</span>
                                <span style="font-size: 0.8rem;">${member.discord}</span>
                            </div>
                        </div>
                        
                        <!-- Botones de acci√≥n -->
                        <div style="display: flex; gap: 0.5rem; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255, 215, 0, 0.2);">
                            <button onclick="editMember(${member.id})" style="flex: 1; background: linear-gradient(45deg, #28a745, #20c997); color: white; border: none; padding: 0.5rem; border-radius: 6px; cursor: pointer; font-size: 0.8rem; font-weight: bold; transition: all 0.3s ease;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                ‚úèÔ∏è Editar
                            </button>
                            <button onclick="deleteMember(${member.id}, '${member.name}')" style="flex: 1; background: linear-gradient(45deg, #dc3545, #c82333); color: white; border: none; padding: 0.5rem; border-radius: 6px; cursor: pointer; font-size: 0.8rem; font-weight: bold; transition: all 0.3s ease;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                üóëÔ∏è Eliminar
                            </button>
                        </div>
                        
                        <!-- Fecha de registro -->
                        <div style="text-align: center; margin-top: 1rem; font-size: 0.7rem; opacity: 0.7;">
                            üìÖ Miembro desde: ${formatDate(member.registeredAt)}
                        </div>
                    </div>
                `;
            });

            membersHTML += '</div>';
            membersContainer.innerHTML = membersHTML;
        }

        // ========== FUNCIONES DE MULTIMEDIA ==========
        
        // Editar post multimedia
        function editMultimediaPost(postId) {
            const post = multimediaContent.find(p => p.id === postId);
            if (!post) {
                alert('Post no encontrado');
                return;
            }
            
            // Crear modal de edici√≥n
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                padding: 2rem;
                overflow-y: auto;
            `;
            
            const typeIcons = {
                'Foto': 'üì∑',
                'Video': 'üé•',
                'Informaci√≥n': 'üìù',
                'Misi√≥n': 'üéØ'
            };
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #2d4a2b, #3d5a3b); padding: 2rem; border-radius: 12px; border: 2px solid #ffd700; max-width: 700px; width: 100%; max-height: 90vh; overflow-y: auto; color: #e8f5e8;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 style="color: #ffd700; margin: 0;">‚úèÔ∏è Editar Post: ${post.title}</h2>
                        <button onclick="closeEditMultimediaModal()" style="background: #dc3545; color: white; border: none; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center;">‚úï</button>
                    </div>
                    
                    <form id="editMultimediaForm">
                        <div style="display: grid; gap: 1.5rem;">
                            <div>
                                <label style="display: block; color: #ffd700; margin-bottom: 0.5rem; font-weight: bold;">T√≠tulo del Post:</label>
                                <input type="text" id="editPostTitle" value="${post.title}" required style="width: 100%; padding: 0.8rem; border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 6px; background: rgba(0,0,0,0.3); color: #e8f5e8; font-size: 1rem;">
                            </div>
                            
                            <div>
                                <label style="display: block; color: #ffd700; margin-bottom: 0.5rem; font-weight: bold;">Tipo de Contenido:</label>
                                <select id="editPostType" required style="width: 100%; padding: 0.8rem; border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 6px; background: rgba(0,0,0,0.3); color: #e8f5e8; font-size: 1rem;">
                                    <option value="Foto" ${post.type === 'Foto' ? 'selected' : ''}>üì∑ Foto</option>
                                    <option value="Video" ${post.type === 'Video' ? 'selected' : ''}>üé• Video</option>
                                    <option value="Informaci√≥n" ${post.type === 'Informaci√≥n' ? 'selected' : ''}>üìù Informaci√≥n</option>
                                    <option value="Misi√≥n" ${post.type === 'Misi√≥n' ? 'selected' : ''}>üéØ Reporte de Misi√≥n</option>
                                </select>
                            </div>
                            
                            <div>
                                <label style="display: block; color: #ffd700; margin-bottom: 0.5rem; font-weight: bold;">üìÅ Contenido Multimedia:</label>
                                
                                <!-- Vista previa del contenido actual -->
                                ${post.mediaUrl ? `
                                    <div style="margin-bottom: 1rem; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px; border: 2px solid rgba(255, 215, 0, 0.3);">
                                        <div style="color: #ffd700; font-weight: bold; margin-bottom: 0.5rem;">üì∑ Contenido Actual:</div>
                                        <div style="text-align: center; margin-bottom: 1rem;">
                                            ${(() => {
                                                if (post.mediaUrl.startsWith('data:image/')) {
                                                    return `<img src="${post.mediaUrl}" style="max-width: 200px; max-height: 150px; object-fit: cover; border-radius: 8px; border: 2px solid #ffd700;">`;
                                                } else if (post.mediaUrl.startsWith('data:video/')) {
                                                    return `<video controls style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 2px solid #ffd700;"><source src="${post.mediaUrl}"></video>`;
                                                } else if (isImageUrl(post.mediaUrl)) {
                                                    return `<img src="${post.mediaUrl}" style="max-width: 200px; max-height: 150px; object-fit: cover; border-radius: 8px; border: 2px solid #ffd700;" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"><div style="display: none; color: #dc3545;">‚ùå Error al cargar imagen</div>`;
                                                } else {
                                                    return `<div style="padding: 1rem; background: rgba(0,0,0,0.3); border-radius: 6px; color: #87ceeb;">üîó ${post.mediaUrl.length > 40 ? post.mediaUrl.substring(0, 40) + '...' : post.mediaUrl}</div>`;
                                                }
                                            })()}
                                        </div>
                                        <div style="font-size: 0.8rem; opacity: 0.8; text-align: center;">
                                            ${post.fileName ? `üìÅ ${post.fileName}` : 'üîó Contenido externo'}
                                        </div>
                                    </div>
                                ` : ''}
                                
                                <!-- Selector de m√©todo -->
                                <div style="display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; background: rgba(255, 215, 0, 0.1); padding: 0.5rem 1rem; border-radius: 6px; border: 2px solid rgba(255, 215, 0, 0.3);">
                                        <input type="radio" name="editMediaMethod" value="file" ${post.mediaMethod === 'file' ? 'checked' : ''} onchange="toggleEditMediaMethod('file')" style="margin: 0;">
                                        üìÅ Subir Nuevo Archivo
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; background: rgba(255, 215, 0, 0.1); padding: 0.5rem 1rem; border-radius: 6px; border: 2px solid rgba(255, 215, 0, 0.3);">
                                        <input type="radio" name="editMediaMethod" value="url" ${post.mediaMethod === 'url' ? 'checked' : ''} onchange="toggleEditMediaMethod('url')" style="margin: 0;">
                                        üîó URL Externa
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; background: rgba(255, 215, 0, 0.1); padding: 0.5rem 1rem; border-radius: 6px; border: 2px solid rgba(255, 215, 0, 0.3);">
                                        <input type="radio" name="editMediaMethod" value="keep" checked onchange="toggleEditMediaMethod('keep')" style="margin: 0;">
                                        ‚úÖ Mantener Actual
                                    </label>
                                </div>
                                
                                <!-- Subir archivo -->
                                <div id="editMediaFileUploadSection" style="display: none;">
                                    <input type="file" id="editMediaFile" accept="image/*,video/*" onchange="handleEditMediaFileSelect(this)" style="width: 100%; padding: 0.8rem; border: 2px dashed rgba(255, 215, 0, 0.5); border-radius: 6px; background: rgba(0,0,0,0.3); color: inherit; font-size: 1rem; cursor: pointer;">
                                    <small style="opacity: 0.7; font-size: 0.8rem; display: block; margin-top: 0.5rem;">
                                        üì∑ Im√°genes: .jpg, .png, .gif, .webp (m√°x. 10MB)<br>
                                        üé• Videos: .mp4, .webm, .mov, .avi (m√°x. 50MB)
                                    </small>
                                    
                                    <!-- Vista previa nueva -->
                                    <div id="editMediaPreview" style="display: none; margin-top: 1rem; text-align: center;">
                                        <div style="display: inline-block; position: relative; max-width: 300px;">
                                            <div id="editMediaPreviewContent"></div>
                                            <button type="button" onclick="clearEditMediaPreview()" style="position: absolute; top: -5px; right: -5px; width: 30px; height: 30px; border-radius: 50%; background: #dc3545; color: white; border: none; cursor: pointer; font-size: 1rem; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">‚úï</button>
                                        </div>
                                        <div id="editMediaPreviewInfo" style="margin-top: 0.5rem; font-size: 0.8rem; color: #ffd700;"></div>
                                    </div>
                                </div>
                                
                                <!-- URL externa -->
                                <div id="editMediaUrlUploadSection" style="display: none;">
                                    <input type="url" id="editMediaUrl" value="${post.mediaMethod === 'url' ? post.mediaUrl || '' : ''}" placeholder="https://ejemplo.com/imagen.jpg o https://youtube.com/watch?v=..." style="width: 100%; padding: 0.8rem; border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 6px; background: rgba(0,0,0,0.3); color: inherit; font-size: 1rem;">
                                    <small style="opacity: 0.7; font-size: 0.8rem; display: block; margin-top: 0.5rem;">
                                        üì∑ Para im√°genes: URL directa (.jpg, .png, .gif)<br>
                                        üé• Para videos: YouTube, Vimeo, o URL directa
                                    </small>
                                </div>
                            </div>
                            
                            <div>
                                <label style="display: block; color: #ffd700; margin-bottom: 0.5rem; font-weight: bold;">Descripci√≥n:</label>
                                <textarea id="editPostDescription" rows="4" required placeholder="Describe tu momento, misi√≥n o informaci√≥n..." style="width: 100%; padding: 0.8rem; border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 6px; background: rgba(0,0,0,0.3); color: #e8f5e8; font-size: 1rem; resize: vertical;">${post.description}</textarea>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                            <button type="button" onclick="closeEditMultimediaModal()" style="flex: 1; background: #6c757d; color: white; border: none; padding: 1rem; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: bold;">
                                Cancelar
                            </button>
                            <button type="submit" style="flex: 1; background: linear-gradient(45deg, #28a745, #20c997); color: white; border: none; padding: 1rem; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: bold;">
                                üíæ Guardar Cambios
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Manejar env√≠o del formulario de edici√≥n
            document.getElementById('editMultimediaForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Obtener contenido multimedia seg√∫n el m√©todo seleccionado
                let mediaContent = post.mediaUrl; // Mantener actual por defecto
                let mediaType = post.mediaType;
                let fileName = post.fileName;
                
                const mediaMethod = document.querySelector('input[name="editMediaMethod"]:checked').value;
                
                if (mediaMethod === 'file') {
                    // Usar nuevo archivo si se subi√≥
                    const mediaPreviewContent = document.getElementById('editMediaPreviewContent');
                    if (mediaPreviewContent && mediaPreviewContent.innerHTML.trim()) {
                        const img = mediaPreviewContent.querySelector('img');
                        const video = mediaPreviewContent.querySelector('video source');
                        
                        if (img && img.src && img.src.startsWith('data:')) {
                            mediaContent = img.src;
                            mediaType = 'image';
                            fileName = document.getElementById('editMediaFile').files[0]?.name || 'imagen.jpg';
                        } else if (video && video.src && video.src.startsWith('data:')) {
                            mediaContent = video.src;
                            mediaType = 'video';
                            fileName = document.getElementById('editMediaFile').files[0]?.name || 'video.mp4';
                        }
                    }
                } else if (mediaMethod === 'url') {
                    // Usar nueva URL
                    mediaContent = document.getElementById('editMediaUrl').value || null;
                    mediaType = 'url';
                    fileName = null;
                }
                // Si es 'keep', mantener los valores actuales
                
                // Actualizar datos del post
                const postIndex = multimediaContent.findIndex(p => p.id === postId);
                if (postIndex !== -1) {
                    multimediaContent[postIndex] = {
                        ...post,
                        title: document.getElementById('editPostTitle').value,
                        type: document.getElementById('editPostType').value,
                        mediaUrl: mediaContent,
                        mediaType: mediaType,
                        fileName: fileName,
                        mediaMethod: mediaMethod === 'keep' ? post.mediaMethod : mediaMethod,
                        description: document.getElementById('editPostDescription').value,
                        lastModified: new Date().toISOString()
                    };
                    
                    // Guardar cambios
                    saveNow('edicion_multimedia').then(() => {
                        showSaveIndicator(`‚úÖ Post "${multimediaContent[postIndex].title}" actualizado exitosamente`);
                        displayMultimedia(); // Actualizar vista
                        closeEditMultimediaModal();
                    });
                }
            });
            
            // Funci√≥n para cerrar modal
            window.closeEditMultimediaModal = function() {
                if (document.body.contains(modal)) {
                    document.body.removeChild(modal);
                }
                delete window.closeEditMultimediaModal;
                delete window.toggleEditMediaMethod;
                delete window.handleEditMediaFileSelect;
                delete window.clearEditMediaPreview;
            };
            
            // Funci√≥n para alternar m√©todo de multimedia en edici√≥n
            window.toggleEditMediaMethod = function(method) {
                const fileSection = document.getElementById('editMediaFileUploadSection');
                const urlSection = document.getElementById('editMediaUrlUploadSection');
                
                if (method === 'file') {
                    fileSection.style.display = 'block';
                    urlSection.style.display = 'none';
                } else if (method === 'url') {
                    fileSection.style.display = 'none';
                    urlSection.style.display = 'block';
                    clearEditMediaPreview();
                } else { // keep
                    fileSection.style.display = 'none';
                    urlSection.style.display = 'none';
                    clearEditMediaPreview();
                }
            };
            
            // Funci√≥n para manejar archivo en edici√≥n
            window.handleEditMediaFileSelect = function(input) {
                const file = input.files[0];
                if (!file) {
                    clearEditMediaPreview();
                    return;
                }
                
                // Validar tipo de archivo
                const isImage = file.type.startsWith('image/');
                const isVideo = file.type.startsWith('video/');
                
                if (!isImage && !isVideo) {
                    alert('Por favor selecciona un archivo de imagen o video v√°lido.');
                    input.value = '';
                    clearEditMediaPreview();
                    return;
                }
                
                // Validar tama√±o seg√∫n tipo
                const maxImageSize = 10 * 1024 * 1024; // 10MB para im√°genes
                const maxVideoSize = 50 * 1024 * 1024; // 50MB para videos
                const maxSize = isImage ? maxImageSize : maxVideoSize;
                
                if (file.size > maxSize) {
                    const maxSizeMB = isImage ? '10MB' : '50MB';
                    alert(`El archivo es demasiado grande. Por favor selecciona un ${isImage ? 'imagen' : 'video'} menor a ${maxSizeMB}.`);
                    input.value = '';
                    clearEditMediaPreview();
                    return;
                }
                
                // Mostrar indicador de carga
                showEditMediaLoadingIndicator(isImage ? 'imagen' : 'video');
                
                // Procesar archivo
                const reader = new FileReader();
                reader.onload = function(e) {
                    if (isImage) {
                        processEditImageFile(e.target.result, file);
                    } else {
                        processEditVideoFile(e.target.result, file);
                    }
                };
                
                reader.onerror = function() {
                    alert('Error al leer el archivo. Por favor intenta de nuevo.');
                    input.value = '';
                    clearEditMediaPreview();
                };
                
                reader.readAsDataURL(file);
            };
            
            // Funciones auxiliares para edici√≥n
            function showEditMediaLoadingIndicator(type) {
                const preview = document.getElementById('editMediaPreview');
                const icon = type === 'imagen' ? 'üì∑' : 'üé•';
                
                preview.style.display = 'block';
                document.getElementById('editMediaPreviewContent').innerHTML = `
                    <div style="width: 200px; height: 150px; border-radius: 8px; border: 3px solid #ffd700; background: rgba(255, 215, 0, 0.1); display: flex; align-items: center; justify-content: center; color: #ffd700; font-size: 3rem;">
                        <div style="animation: spin 1s linear infinite;">${icon}</div>
                    </div>
                `;
                document.getElementById('editMediaPreviewInfo').innerHTML = `Procesando ${type}...`;
            }
            
            function processEditImageFile(dataUrl, file) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    let { width, height } = img;
                    const maxDimension = 1200;
                    
                    if (width > maxDimension || height > maxDimension) {
                        if (width > height) {
                            height = (height * maxDimension) / width;
                            width = maxDimension;
                        } else {
                            width = (width * maxDimension) / height;
                            height = maxDimension;
                        }
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    const optimizedDataUrl = canvas.toDataURL('image/jpeg', 0.85);
                    showEditMediaPreview(optimizedDataUrl, file, 'image');
                };
                
                img.onerror = function() {
                    alert('Error al procesar la imagen. Por favor intenta con otra imagen.');
                    document.getElementById('editMediaFile').value = '';
                    clearEditMediaPreview();
                };
                
                img.src = dataUrl;
            }
            
            function processEditVideoFile(dataUrl, file) {
                if (file.size > 20 * 1024 * 1024) {
                    if (!confirm(`El video es grande (${(file.size / 1024 / 1024).toFixed(1)}MB). Esto puede afectar el rendimiento. ¬øContinuar?`)) {
                        document.getElementById('editMediaFile').value = '';
                        clearEditMediaPreview();
                        return;
                    }
                }
                
                showEditMediaPreview(dataUrl, file, 'video');
            }
            
            function showEditMediaPreview(dataUrl, file, type) {
                const preview = document.getElementById('editMediaPreview');
                const content = document.getElementById('editMediaPreviewContent');
                const info = document.getElementById('editMediaPreviewInfo');
                
                preview.style.display = 'block';
                
                if (type === 'image') {
                    content.innerHTML = `
                        <img src="${dataUrl}" 
                             style="max-width: 200px; max-height: 150px; object-fit: cover; border-radius: 8px; border: 3px solid #ffd700; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);">
                    `;
                    info.innerHTML = `
                        ‚úÖ ${file.name}<br>
                        <span style="opacity: 0.7; font-size: 0.7rem;">üì∑ Nueva imagen - ${(dataUrl.length / 1024).toFixed(1)}KB</span>
                    `;
                } else if (type === 'video') {
                    content.innerHTML = `
                        <video controls style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 3px solid #ffd700; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);">
                            <source src="${dataUrl}" type="${file.type}">
                            Tu navegador no soporta la reproducci√≥n de video.
                        </video>
                    `;
                    info.innerHTML = `
                        ‚úÖ ${file.name}<br>
                        <span style="opacity: 0.7; font-size: 0.7rem;">üé• Nuevo video - ${(file.size / 1024 / 1024).toFixed(1)}MB</span>
                    `;
                }
            }
            
            // Funci√≥n para limpiar vista previa en edici√≥n
            window.clearEditMediaPreview = function() {
                const preview = document.getElementById('editMediaPreview');
                const fileInput = document.getElementById('editMediaFile');
                
                preview.style.display = 'none';
                document.getElementById('editMediaPreviewContent').innerHTML = '';
                document.getElementById('editMediaPreviewInfo').innerHTML = '';
                
                if (fileInput) {
                    fileInput.value = '';
                }
            };
        }
        
        // Eliminar post multimedia
        function deleteMultimediaPost(postId, postTitle, postType) {
            if (confirm(`¬øEst√°s seguro de que quieres eliminar el post "${postTitle}"?`)) {
                if (confirm(`Esta acci√≥n eliminar√° permanentemente el post de tipo "${postType}". ¬øContinuar?`)) {
                    const postIndex = multimediaContent.findIndex(p => p.id === postId);
                    if (postIndex !== -1) {
                        multimediaContent.splice(postIndex, 1);
                        
                        saveNow('eliminacion_multimedia').then(() => {
                            showSaveIndicator(`‚úÖ Post "${postTitle}" eliminado exitosamente`);
                            displayMultimedia(); // Actualizar vista
                        });
                    }
                }
            }
        }
        
        function displayMultimedia() {
            const multimediaContainer = document.getElementById('multimediaFeed');
            
            if (multimediaContent.length === 0) {
                multimediaContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì∑</div>
                        <div>No hay momentos compartidos</div>
                        <div style="margin-top: 1rem; font-size: 1rem; opacity: 0.8;">
                            ¬°Comparte el primer momento de la compa√±√≠a!
                        </div>
                    </div>
                `;
                return;
            }

            let multimediaHTML = '<div style="display: grid; gap: 2rem;">';

            // Ordenar por fecha m√°s reciente
            const sortedContent = [...multimediaContent].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

            sortedContent.forEach(post => {
                const typeIcons = {
                    'Foto': 'üì∑',
                    'Video': 'üé•',
                    'Informaci√≥n': 'üìù',
                    'Misi√≥n': 'üéØ'
                };

                multimediaHTML += `
                    <div class="form-container" style="max-width: none; margin: 0;">
                        <!-- Header del post -->
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid rgba(255, 215, 0, 0.3);">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <div style="width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(45deg, #8b4513, #a0522d); border: 2px solid #ffd700; display: flex; align-items: center; justify-content: center; color: #ffd700; font-weight: bold; font-size: 1.2rem;">
                                    C
                                </div>
                                <div>
                                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.3rem;">
                                        <span style="font-weight: bold; color: #ffd700;">Compa√±ero</span>
                                        <span>üåç</span>
                                        <span style="background: linear-gradient(45deg, #8b4513, #a0522d); color: #ffd700; padding: 0.2rem 0.6rem; border-radius: 10px; font-size: 0.7rem; border: 1px solid #ffd700;">
                                            ${typeIcons[post.type]} ${post.type}
                                        </span>
                                    </div>
                                    <div style="font-size: 0.8rem; opacity: 0.8;">
                                        üìÖ ${formatDateTime(post.createdAt)}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- T√≠tulo del post -->
                        <h3 style="color: #ffd700; margin: 0 0 1rem 0; font-size: 1.4rem; display: flex; align-items: center; gap: 0.5rem;">
                            <span style="font-size: 1.5rem;">${typeIcons[post.type]}</span>
                            ${post.title}
                        </h3>

                        <!-- Contenido multimedia -->
                        ${post.mediaUrl ? `
                            <div style="margin-bottom: 1.5rem;">
                                ${(() => {
                                    // Verificar si es archivo local (base64) - IMAGEN
                                    if ((post.mediaType === 'image' || post.mediaUrl.startsWith('data:image/')) && post.mediaUrl.startsWith('data:image/')) {
                                        return `
                                            <div style="text-align: center; margin-bottom: 1rem;">
                                                <div style="position: relative; display: inline-block; max-width: 100%;">
                                                    <img src="${post.mediaUrl}" 
                                                         alt="${post.title}" 
                                                         style="max-width: 100%; max-height: 500px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); cursor: pointer;"
                                                         onclick="openImageModal('${post.mediaUrl}', '${post.title}')">
                                                    <div style="position: absolute; bottom: 5px; right: 5px; background: rgba(0,0,0,0.7); color: #ffd700; padding: 0.3rem 0.6rem; border-radius: 4px; font-size: 0.7rem;">
                                                        üìÅ ${post.fileName || 'Imagen local'}
                                                    </div>
                                                </div>
                                            </div>
                                        `;
                                    } 
                                    // Verificar si es archivo local (base64) - VIDEO
                                    else if ((post.mediaType === 'video' || post.mediaUrl.startsWith('data:video/')) && post.mediaUrl.startsWith('data:video/')) {
                                        // Detectar tipo de video desde el data URL con mejor compatibilidad
                                        let videoType = 'video/mp4'; // Por defecto MP4
                                        let videoFormat = 'MP4';
                                        
                                        if (post.mediaUrl.includes('data:video/mp4')) {
                                            videoType = 'video/mp4';
                                            videoFormat = 'MP4';
                                        } else if (post.mediaUrl.includes('data:video/webm')) {
                                            videoType = 'video/webm';
                                            videoFormat = 'WebM';
                                        } else if (post.mediaUrl.includes('data:video/ogg')) {
                                            videoType = 'video/ogg';
                                            videoFormat = 'OGG';
                                        } else if (post.mediaUrl.includes('data:video/avi')) {
                                            videoType = 'video/avi';
                                            videoFormat = 'AVI';
                                        } else if (post.mediaUrl.includes('data:video/mov') || post.mediaUrl.includes('data:video/quicktime')) {
                                            videoType = 'video/quicktime';
                                            videoFormat = 'MOV';
                                        }
                                        
                                        return `
                                            <div style="margin-bottom: 1rem; text-align: center;">
                                                <div style="position: relative; display: inline-block; max-width: 100%; background: linear-gradient(135deg, #000, #1a1a1a); border-radius: 12px; overflow: hidden; border: 3px solid #ffd700; box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);">
                                                    <video 
                                                        id="video_${post.id}"
                                                        controls 
                                                        preload="auto"
                                                        crossorigin="anonymous"
                                                        playsinline
                                                        style="width: 100%; max-width: 700px; height: auto; max-height: 500px; display: block; background: #000;"
                                                        onloadstart="console.log('üé• [${videoFormat}] Iniciando carga:', '${post.fileName || 'Video'}'); this.parentElement.querySelector('.video-status').innerHTML = '‚è≥ Cargando ${videoFormat}...';"
                                                        onloadedmetadata="console.log('üìä [${videoFormat}] Metadatos cargados:', this.duration + 's'); this.parentElement.querySelector('.video-status').innerHTML = 'üìä Video listo (' + Math.round(this.duration) + 's)';"
                                                        oncanplay="console.log('‚úÖ [${videoFormat}] Listo para reproducir'); this.parentElement.querySelector('.video-status').innerHTML = '‚úÖ ${videoFormat} - Haz clic en ‚ñ∂Ô∏è';"
                                                        onplay="console.log('‚ñ∂Ô∏è [${videoFormat}] Reproduciendo'); this.parentElement.querySelector('.video-status').innerHTML = '‚ñ∂Ô∏è Reproduciendo ${videoFormat}';"
                                                        onpause="console.log('‚è∏Ô∏è [${videoFormat}] Pausado'); this.parentElement.querySelector('.video-status').innerHTML = '‚è∏Ô∏è ${videoFormat} pausado';"
                                                        onended="console.log('üèÅ [${videoFormat}] Finalizado'); this.parentElement.querySelector('.video-status').innerHTML = 'üèÅ Video finalizado';"
                                                        onerror="console.error('‚ùå [${videoFormat}] Error de reproducci√≥n'); this.style.display='none'; this.parentElement.querySelector('.video-error').style.display='block'; this.parentElement.querySelector('.video-status').innerHTML = '‚ùå Error de reproducci√≥n';"
                                                        onwaiting="console.log('‚è≥ [${videoFormat}] Buffering...'); this.parentElement.querySelector('.video-status').innerHTML = '‚è≥ Cargando buffer...';"
                                                        onplaying="console.log('üé¨ [${videoFormat}] Reproduciendo sin interrupciones'); this.parentElement.querySelector('.video-status').innerHTML = 'üé¨ Reproduciendo';"
                                                    >
                                                        <!-- M√∫ltiples fuentes para m√°xima compatibilidad -->
                                                        <source src="${post.mediaUrl}" type="${videoType}">
                                                        <source src="${post.mediaUrl}" type="video/mp4">
                                                        <source src="${post.mediaUrl}" type="video/webm">
                                                        <source src="${post.mediaUrl}" type="video/ogg">
                                                        <source src="${post.mediaUrl}" type="video/avi">
                                                        <source src="${post.mediaUrl}" type="video/quicktime">
                                                        
                                                        <!-- Mensaje de fallback -->
                                                        <div style="padding: 2rem; color: #ffd700; text-align: center; background: rgba(255, 215, 0, 0.1);">
                                                            <div style="font-size: 2rem; margin-bottom: 1rem;">üé•</div>
                                                            <div>Tu navegador no soporta la reproducci√≥n de video HTML5</div>
                                                            <div style="font-size: 0.8rem; margin-top: 0.5rem; opacity: 0.8;">
                                                                Intenta con Chrome, Firefox, Safari o Edge
                                                            </div>
                                                        </div>
                                                    </video>
                                                    
                                                    <!-- Mensaje de error (oculto por defecto) -->
                                                    <div class="video-error" style="display: none; padding: 2rem; background: rgba(220,53,69,0.2); border-radius: 8px; color: #dc3545; text-align: center;">
                                                        <div style="font-size: 2rem; margin-bottom: 1rem;">‚ùå</div>
                                                        <div style="font-weight: bold; margin-bottom: 0.5rem;">Error al reproducir video ${videoFormat}</div>
                                                        <div style="font-size: 0.9rem; margin-bottom: 1rem;">
                                                            ${post.fileName || 'Video local'} - Posibles causas:
                                                        </div>
                                                        <div style="font-size: 0.8rem; text-align: left; background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 6px; margin: 1rem 0;">
                                                            ‚Ä¢ Formato ${videoFormat} no compatible con tu navegador<br>
                                                            ‚Ä¢ Archivo corrupto o incompleto<br>
                                                            ‚Ä¢ Codec de video no soportado<br>
                                                            ‚Ä¢ Archivo demasiado grande para el navegador
                                                        </div>
                                                        <div style="font-size: 0.8rem; color: #87ceeb;">
                                                            üí° Intenta convertir el video a MP4 H.264 para mejor compatibilidad
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Informaci√≥n del video -->
                                                    <div style="position: absolute; top: 8px; left: 8px; background: rgba(0,0,0,0.8); color: #ffd700; padding: 0.4rem 0.8rem; border-radius: 6px; font-size: 0.7rem; font-weight: bold; border: 1px solid #ffd700;">
                                                        üé• ${videoFormat} Local
                                                    </div>
                                                    
                                                    <!-- Nombre del archivo -->
                                                    <div style="position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.8); color: #ffd700; padding: 0.4rem 0.8rem; border-radius: 6px; font-size: 0.7rem; font-weight: bold; border: 1px solid #ffd700; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                                        üìÅ ${post.fileName || 'video.mp4'}
                                                    </div>
                                                </div>
                                                
                                                <!-- Estado del video -->
                                                <div class="video-status" style="margin-top: 1rem; font-size: 0.9rem; color: #ffd700; opacity: 0.9; background: rgba(255, 215, 0, 0.1); padding: 0.6rem 1rem; border-radius: 8px; border: 1px solid rgba(255, 215, 0, 0.3); font-weight: bold;">
                                                    üé¨ Video ${videoFormat} cargado - Haz clic en ‚ñ∂Ô∏è para reproducir
                                                </div>
                                                
                                                <!-- Informaci√≥n t√©cnica -->
                                                <div style="margin-top: 0.5rem; font-size: 0.7rem; opacity: 0.7; text-align: center;">
                                                    üìä Formato: ${videoFormat} | üíæ Archivo local | üîß M√∫ltiples codecs soportados
                                                </div>
                                            </div>
                                        `;
                                    } 
                                    // URL externa de imagen
                                    else if (isImageUrl(post.mediaUrl)) {
                                        return `
                                            <div style="text-align: center; margin-bottom: 1rem;">
                                                <div style="position: relative; display: inline-block; max-width: 100%;">
                                                    <img src="${post.mediaUrl}" 
                                                         alt="${post.title}" 
                                                         style="max-width: 100%; max-height: 500px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); cursor: pointer;"
                                                         onclick="openImageModal('${post.mediaUrl}', '${post.title}')"
                                                         onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                                    <div style="display: none; background: rgba(220,53,69,0.2); padding: 2rem; border-radius: 8px; border: 2px dashed #dc3545; color: #dc3545; text-align: center;">
                                                        <div style="font-size: 2rem; margin-bottom: 1rem;">‚ùå</div>
                                                        <div>Error al cargar la imagen</div>
                                                    </div>
                                                    <div style="position: absolute; bottom: 5px; right: 5px; background: rgba(0,0,0,0.7); color: #87ceeb; padding: 0.3rem 0.6rem; border-radius: 4px; font-size: 0.7rem;">
                                                        üîó Imagen externa
                                                    </div>
                                                </div>
                                            </div>
                                        `;
                                    } 
                                    // URL externa de video
                                    else if (isVideoUrl(post.mediaUrl)) {
                                        return `
                                            <div style="margin-bottom: 1rem;">
                                                ${getVideoEmbed(post.mediaUrl)}
                                                <div style="text-align: center; margin-top: 0.5rem;">
                                                    <span style="background: rgba(0,0,0,0.7); color: #87ceeb; padding: 0.3rem 0.6rem; border-radius: 4px; font-size: 0.7rem;">
                                                        üé• Video externo
                                                    </span>
                                                </div>
                                            </div>
                                        `;
                                    } 
                                    // Intentar detectar autom√°ticamente el tipo de archivo
                                    else if (post.mediaUrl.startsWith('data:')) {
                                        // Es un archivo base64, intentar detectar tipo
                                        if (post.mediaUrl.includes('data:image/')) {
                                            return `
                                                <div style="text-align: center; margin-bottom: 1rem;">
                                                    <div style="position: relative; display: inline-block; max-width: 100%;">
                                                        <img src="${post.mediaUrl}" 
                                                             alt="${post.title}" 
                                                             style="max-width: 100%; max-height: 500px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); cursor: pointer;"
                                                             onclick="openImageModal('${post.mediaUrl}', '${post.title}')">
                                                        <div style="position: absolute; bottom: 5px; right: 5px; background: rgba(0,0,0,0.7); color: #ffd700; padding: 0.3rem 0.6rem; border-radius: 4px; font-size: 0.7rem;">
                                                            üì∑ ${post.fileName || 'Imagen'}
                                                        </div>
                                                    </div>
                                                </div>
                                            `;
                                        } else if (post.mediaUrl.includes('data:video/')) {
                                            // Detectar tipo de video desde el data URL con m√°xima compatibilidad
                                            let videoType = 'video/mp4'; // Por defecto MP4
                                            let videoFormat = 'MP4';
                                            
                                            if (post.mediaUrl.includes('data:video/mp4')) {
                                                videoType = 'video/mp4';
                                                videoFormat = 'MP4';
                                            } else if (post.mediaUrl.includes('data:video/webm')) {
                                                videoType = 'video/webm';
                                                videoFormat = 'WebM';
                                            } else if (post.mediaUrl.includes('data:video/ogg')) {
                                                videoType = 'video/ogg';
                                                videoFormat = 'OGG';
                                            } else if (post.mediaUrl.includes('data:video/avi')) {
                                                videoType = 'video/avi';
                                                videoFormat = 'AVI';
                                            } else if (post.mediaUrl.includes('data:video/mov') || post.mediaUrl.includes('data:video/quicktime')) {
                                                videoType = 'video/quicktime';
                                                videoFormat = 'MOV/QuickTime';
                                            }
                                            
                                            return `
                                                <div style="margin-bottom: 1rem; text-align: center;">
                                                    <div style="position: relative; display: inline-block; max-width: 100%; background: linear-gradient(135deg, #000, #1a1a1a); border-radius: 12px; overflow: hidden; border: 3px solid #ffd700; box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);">
                                                        <video 
                                                            id="auto_video_${Date.now()}"
                                                            controls 
                                                            preload="auto"
                                                            crossorigin="anonymous"
                                                            playsinline
                                                            style="width: 100%; max-width: 700px; height: auto; max-height: 500px; display: block; background: #000;"
                                                            onloadstart="console.log('üé• [AUTO-${videoFormat}] Iniciando carga:', '${post.fileName || 'Video'}'); this.parentElement.querySelector('.auto-video-status').innerHTML = '‚è≥ Cargando ${videoFormat}...';"
                                                            onloadedmetadata="console.log('üìä [AUTO-${videoFormat}] Metadatos cargados:', this.duration + 's'); this.parentElement.querySelector('.auto-video-status').innerHTML = 'üìä Video listo (' + Math.round(this.duration) + 's)';"
                                                            oncanplay="console.log('‚úÖ [AUTO-${videoFormat}] Listo para reproducir'); this.parentElement.querySelector('.auto-video-status').innerHTML = '‚úÖ ${videoFormat} - Haz clic en ‚ñ∂Ô∏è';"
                                                            onplay="console.log('‚ñ∂Ô∏è [AUTO-${videoFormat}] Reproduciendo'); this.parentElement.querySelector('.auto-video-status').innerHTML = '‚ñ∂Ô∏è Reproduciendo ${videoFormat}';"
                                                            onpause="console.log('‚è∏Ô∏è [AUTO-${videoFormat}] Pausado'); this.parentElement.querySelector('.auto-video-status').innerHTML = '‚è∏Ô∏è ${videoFormat} pausado';"
                                                            onended="console.log('üèÅ [AUTO-${videoFormat}] Finalizado'); this.parentElement.querySelector('.auto-video-status').innerHTML = 'üèÅ Video finalizado';"
                                                            onerror="console.error('‚ùå [AUTO-${videoFormat}] Error de reproducci√≥n'); this.style.display='none'; this.parentElement.querySelector('.auto-video-error').style.display='block'; this.parentElement.querySelector('.auto-video-status').innerHTML = '‚ùå Error de reproducci√≥n';"
                                                            onwaiting="console.log('‚è≥ [AUTO-${videoFormat}] Buffering...'); this.parentElement.querySelector('.auto-video-status').innerHTML = '‚è≥ Cargando buffer...';"
                                                            onplaying="console.log('üé¨ [AUTO-${videoFormat}] Reproduciendo sin interrupciones'); this.parentElement.querySelector('.auto-video-status').innerHTML = 'üé¨ Reproduciendo';"
                                                        >
                                                            <!-- M√∫ltiples fuentes para m√°xima compatibilidad -->
                                                            <source src="${post.mediaUrl}" type="${videoType}">
                                                            <source src="${post.mediaUrl}" type="video/mp4">
                                                            <source src="${post.mediaUrl}" type="video/webm">
                                                            <source src="${post.mediaUrl}" type="video/ogg">
                                                            <source src="${post.mediaUrl}" type="video/avi">
                                                            <source src="${post.mediaUrl}" type="video/quicktime">
                                                            
                                                            <!-- Mensaje de fallback -->
                                                            <div style="padding: 2rem; color: #ffd700; text-align: center; background: rgba(255, 215, 0, 0.1);">
                                                                <div style="font-size: 2rem; margin-bottom: 1rem;">üé•</div>
                                                                <div>Tu navegador no soporta la reproducci√≥n de video HTML5</div>
                                                                <div style="font-size: 0.8rem; margin-top: 0.5rem; opacity: 0.8;">
                                                                    Intenta con Chrome, Firefox, Safari o Edge
                                                                </div>
                                                            </div>
                                                        </video>
                                                        
                                                        <!-- Mensaje de error (oculto por defecto) -->
                                                        <div class="auto-video-error" style="display: none; padding: 2rem; background: rgba(220,53,69,0.2); border-radius: 8px; color: #dc3545; text-align: center;">
                                                            <div style="font-size: 2rem; margin-bottom: 1rem;">‚ùå</div>
                                                            <div style="font-weight: bold; margin-bottom: 0.5rem;">Error al reproducir video ${videoFormat}</div>
                                                            <div style="font-size: 0.9rem; margin-bottom: 1rem;">
                                                                ${post.fileName || 'Video detectado autom√°ticamente'} - Posibles causas:
                                                            </div>
                                                            <div style="font-size: 0.8rem; text-align: left; background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 6px; margin: 1rem 0;">
                                                                ‚Ä¢ Formato ${videoFormat} no compatible con tu navegador<br>
                                                                ‚Ä¢ Archivo corrupto o incompleto<br>
                                                                ‚Ä¢ Codec de video no soportado<br>
                                                                ‚Ä¢ Archivo demasiado grande para el navegador<br>
                                                                ‚Ä¢ Detecci√≥n autom√°tica incorrecta del formato
                                                            </div>
                                                            <div style="font-size: 0.8rem; color: #87ceeb;">
                                                                üí° Intenta convertir el video a MP4 H.264 para mejor compatibilidad
                                                            </div>
                                                        </div>
                                                        
                                                        <!-- Informaci√≥n del video -->
                                                        <div style="position: absolute; top: 8px; left: 8px; background: rgba(0,0,0,0.8); color: #ffd700; padding: 0.4rem 0.8rem; border-radius: 6px; font-size: 0.7rem; font-weight: bold; border: 1px solid #ffd700;">
                                                            üé• ${videoFormat} Auto-detectado
                                                        </div>
                                                        
                                                        <!-- Nombre del archivo -->
                                                        <div style="position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.8); color: #ffd700; padding: 0.4rem 0.8rem; border-radius: 6px; font-size: 0.7rem; font-weight: bold; border: 1px solid #ffd700; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                                            üìÅ ${post.fileName || 'video.' + videoFormat.toLowerCase()}
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Estado del video -->
                                                    <div class="auto-video-status" style="margin-top: 1rem; font-size: 0.9rem; color: #ffd700; opacity: 0.9; background: rgba(255, 215, 0, 0.1); padding: 0.6rem 1rem; border-radius: 8px; border: 1px solid rgba(255, 215, 0, 0.3); font-weight: bold;">
                                                        üé¨ Video ${videoFormat} detectado autom√°ticamente - Haz clic en ‚ñ∂Ô∏è para reproducir
                                                    </div>
                                                    
                                                    <!-- Informaci√≥n t√©cnica -->
                                                    <div style="margin-top: 0.5rem; font-size: 0.7rem; opacity: 0.7; text-align: center;">
                                                        üìä Formato: ${videoFormat} | üíæ Archivo local | ü§ñ Detecci√≥n autom√°tica | üîß M√∫ltiples codecs
                                                    </div>
                                                </div>
                                            `;
                                        } else {
                                            // Archivo base64 desconocido
                                            return `
                                                <div style="background: rgba(0,0,0,0.5); padding: 2rem; border-radius: 8px; border: 2px dashed rgba(255, 215, 0, 0.5); text-align: center;">
                                                    <div style="font-size: 3rem; margin-bottom: 1rem;">üìÅ</div>
                                                    <div style="color: #ffd700; font-weight: bold; margin-bottom: 1rem;">Archivo Cargado</div>
                                                    <div style="font-size: 0.9rem; opacity: 0.8; margin-bottom: 1rem;">
                                                        ${post.fileName || 'Archivo local'}<br>
                                                        <span style="font-size: 0.7rem;">Tipo: ${post.mediaUrl.split(';')[0].replace('data:', '') || 'Desconocido'}</span>
                                                    </div>
                                                    <div style="font-size: 0.8rem; opacity: 0.7;">
                                                        El archivo se ha cargado pero no se puede previsualizar
                                                    </div>
                                                </div>
                                            `;
                                        }
                                    } 
                                    // Contenido no reconocido (URL externa)
                                    else {
                                        return `
                                            <div style="background: rgba(0,0,0,0.5); padding: 2rem; border-radius: 8px; border: 2px dashed rgba(255, 215, 0, 0.5); text-align: center;">
                                                <div style="font-size: 3rem; margin-bottom: 1rem;">üîó</div>
                                                <div style="color: #ffd700; font-weight: bold; margin-bottom: 1rem;">Contenido Enlazado</div>
                                                <a href="${post.mediaUrl}" target="_blank" rel="noopener noreferrer" style="color: #87ceeb; text-decoration: underline; word-break: break-all; display: block; margin-bottom: 1rem;">
                                                    ${post.mediaUrl.length > 60 ? post.mediaUrl.substring(0, 60) + '...' : post.mediaUrl}
                                                </a>
                                                <div style="font-size: 0.9rem; opacity: 0.8;">
                                                    Haz clic para abrir en nueva pesta√±a
                                                </div>
                                            </div>
                                        `;
                                    }
                                })()}
                            </div>
                        ` : ''}

                        <!-- Descripci√≥n -->
                        <div style="line-height: 1.6; margin-bottom: 1rem; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px; border-left: 4px solid #ffd700;">
                            ${post.description.replace(/\n/g, '<br>')}
                        </div>

                        <!-- Botones de acci√≥n -->
                        <div style="display: flex; gap: 0.5rem; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255, 215, 0, 0.2);">
                            <button onclick="editMultimediaPost(${post.id})" style="flex: 1; background: linear-gradient(45deg, #28a745, #20c997); color: white; border: none; padding: 0.6rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: bold; transition: all 0.3s ease;" onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                                ‚úèÔ∏è Editar Post
                            </button>
                            <button onclick="deleteMultimediaPost(${post.id}, '${post.title.replace(/'/g, "\\'")}', '${post.type}')" style="flex: 1; background: linear-gradient(45deg, #dc3545, #c82333); color: white; border: none; padding: 0.6rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: bold; transition: all 0.3s ease;" onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                                üóëÔ∏è Eliminar
                            </button>
                        </div>

                        <!-- Botones de acci√≥n -->
                        <div style="display: flex; gap: 0.5rem; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255, 215, 0, 0.2);">
                            <button onclick="editMultimediaPost(${post.id})" style="flex: 1; background: linear-gradient(45deg, #28a745, #20c997); color: white; border: none; padding: 0.6rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: bold; transition: all 0.3s ease;" onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                                ‚úèÔ∏è Editar Post
                            </button>
                            <button onclick="deleteMultimediaPost(${post.id}, '${post.title.replace(/'/g, "\\'")}', '${post.type}')" style="flex: 1; background: linear-gradient(45deg, #dc3545, #c82333); color: white; border: none; padding: 0.6rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: bold; transition: all 0.3s ease;" onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                                üóëÔ∏è Eliminar
                            </button>
                        </div>

                        <!-- Footer del post -->
                        <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.8rem; opacity: 0.7; padding-top: 1rem; border-top: 1px solid rgba(255, 215, 0, 0.2); margin-top: 1rem;">
                            <div>
                                üí¨ Publicado por Compa√±ero
                            </div>
                            <div>
                                üïí ${getTimeAgo(post.createdAt)}
                            </div>
                        </div>
                    </div>
                `;
            });

            multimediaHTML += '</div>';
            multimediaContainer.innerHTML = multimediaHTML;
        }

        function getTimeAgo(dateString) {
            const now = new Date();
            const postDate = new Date(dateString);
            const diffInMinutes = Math.floor((now - postDate) / (1000 * 60));
            
            if (diffInMinutes < 1) return 'Ahora mismo';
            if (diffInMinutes < 60) return `Hace ${diffInMinutes} min`;
            
            const diffInHours = Math.floor(diffInMinutes / 60);
            if (diffInHours < 24) return `Hace ${diffInHours}h`;
            
            const diffInDays = Math.floor(diffInHours / 24);
            if (diffInDays < 7) return `Hace ${diffInDays}d`;
            
            return formatDate(dateString);
        }

        // Funciones para detectar tipos de URL
        function isImageUrl(url) {
            if (!url) return false;
            // Detectar URLs de im√°genes directas
            if (/\.(jpg|jpeg|png|gif|webp|bmp|svg)(\?.*)?$/i.test(url)) return true;
            // Detectar algunos servicios de im√°genes comunes
            if (url.includes('imgur.com') || url.includes('i.redd.it') || url.includes('cdn.discordapp.com')) return true;
            return false;
        }

        function isVideoUrl(url) {
            if (!url) return false;
            // YouTube
            if (url.includes('youtube.com/watch?v=') || url.includes('youtu.be/')) return true;
            // Vimeo
            if (url.includes('vimeo.com/')) return true;
            // Videos directos
            if (/\.(mp4|webm|ogg|avi|mov|mkv)(\?.*)?$/i.test(url)) return true;
            return false;
        }

        function getVideoEmbed(url) {
            // YouTube formato completo
            if (url.includes('youtube.com/watch?v=')) {
                const videoId = url.split('v=')[1].split('&')[0];
                return `
                    <div style="position: relative; width: 100%; height: 0; padding-bottom: 56.25%; border-radius: 8px; overflow: hidden;">
                        <iframe 
                            src="https://www.youtube.com/embed/${videoId}" 
                            frameborder="0" 
                            allowfullscreen 
                            style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">
                        </iframe>
                    </div>
                `;
            }
            
            // YouTube formato corto
            if (url.includes('youtu.be/')) {
                const videoId = url.split('youtu.be/')[1].split('?')[0];
                return `
                    <div style="position: relative; width: 100%; height: 0; padding-bottom: 56.25%; border-radius: 8px; overflow: hidden;">
                        <iframe 
                            src="https://www.youtube.com/embed/${videoId}" 
                            frameborder="0" 
                            allowfullscreen 
                            style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">
                        </iframe>
                    </div>
                `;
            }
            
            // Vimeo
            if (url.includes('vimeo.com/')) {
                const videoId = url.split('vimeo.com/')[1].split('?')[0].split('/')[0];
                return `
                    <div style="position: relative; width: 100%; height: 0; padding-bottom: 56.25%; border-radius: 8px; overflow: hidden;">
                        <iframe 
                            src="https://player.vimeo.com/video/${videoId}" 
                            frameborder="0" 
                            allowfullscreen 
                            style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">
                        </iframe>
                    </div>
                `;
            }
            
            // Video directo
            if (url.match(/\.(mp4|webm|ogg|avi|mov|mkv)(\?.*)?$/i)) {
                // Detectar formato del video desde la URL
                let videoFormat = 'MP4';
                let videoType = 'video/mp4';
                
                if (url.match(/\.webm(\?.*)?$/i)) {
                    videoFormat = 'WebM';
                    videoType = 'video/webm';
                } else if (url.match(/\.ogg(\?.*)?$/i)) {
                    videoFormat = 'OGG';
                    videoType = 'video/ogg';
                } else if (url.match(/\.avi(\?.*)?$/i)) {
                    videoFormat = 'AVI';
                    videoType = 'video/avi';
                } else if (url.match(/\.(mov|mkv)(\?.*)?$/i)) {
                    videoFormat = 'MOV/MKV';
                    videoType = 'video/quicktime';
                }
                
                return `
                    <div style="text-align: center; margin-bottom: 1rem;">
                        <div style="position: relative; display: inline-block; max-width: 100%; background: linear-gradient(135deg, #000, #1a1a1a); border-radius: 12px; overflow: hidden; border: 3px solid #87ceeb; box-shadow: 0 8px 25px rgba(135, 206, 235, 0.3);">
                            <video 
                                id="external_video_${Date.now()}"
                                controls 
                                preload="auto"
                                crossorigin="anonymous"
                                playsinline
                                style="width: 100%; max-width: 700px; height: auto; max-height: 500px; display: block; background: #000;"
                                onloadstart="console.log('üé• [EXT-${videoFormat}] Iniciando carga:', '${url}'); this.parentElement.querySelector('.ext-video-status').innerHTML = '‚è≥ Cargando ${videoFormat} externo...';"
                                onloadedmetadata="console.log('üìä [EXT-${videoFormat}] Metadatos cargados:', this.duration + 's'); this.parentElement.querySelector('.ext-video-status').innerHTML = 'üìä Video externo listo (' + Math.round(this.duration) + 's)';"
                                oncanplay="console.log('‚úÖ [EXT-${videoFormat}] Listo para reproducir'); this.parentElement.querySelector('.ext-video-status').innerHTML = '‚úÖ ${videoFormat} externo - Haz clic en ‚ñ∂Ô∏è';"
                                onplay="console.log('‚ñ∂Ô∏è [EXT-${videoFormat}] Reproduciendo'); this.parentElement.querySelector('.ext-video-status').innerHTML = '‚ñ∂Ô∏è Reproduciendo ${videoFormat} externo';"
                                onpause="console.log('‚è∏Ô∏è [EXT-${videoFormat}] Pausado'); this.parentElement.querySelector('.ext-video-status').innerHTML = '‚è∏Ô∏è ${videoFormat} externo pausado';"
                                onended="console.log('üèÅ [EXT-${videoFormat}] Finalizado'); this.parentElement.querySelector('.ext-video-status').innerHTML = 'üèÅ Video externo finalizado';"
                                onerror="console.error('‚ùå [EXT-${videoFormat}] Error cargando video externo'); this.style.display='none'; this.parentElement.querySelector('.ext-video-error').style.display='block'; this.parentElement.querySelector('.ext-video-status').innerHTML = '‚ùå Error cargando video externo';"
                                onwaiting="console.log('‚è≥ [EXT-${videoFormat}] Buffering...'); this.parentElement.querySelector('.ext-video-status').innerHTML = '‚è≥ Buffering ${videoFormat}...';"
                                onplaying="console.log('üé¨ [EXT-${videoFormat}] Reproduciendo sin interrupciones'); this.parentElement.querySelector('.ext-video-status').innerHTML = 'üé¨ Reproduciendo ${videoFormat}';"
                            >
                                <!-- M√∫ltiples fuentes para m√°xima compatibilidad -->
                                <source src="${url}" type="${videoType}">
                                <source src="${url}" type="video/mp4">
                                <source src="${url}" type="video/webm">
                                <source src="${url}" type="video/ogg">
                                <source src="${url}" type="video/avi">
                                <source src="${url}" type="video/quicktime">
                                
                                <!-- Mensaje de fallback -->
                                <div style="padding: 2rem; color: #87ceeb; text-align: center; background: rgba(135, 206, 235, 0.1);">
                                    <div style="font-size: 2rem; margin-bottom: 1rem;">üé•</div>
                                    <div>Tu navegador no soporta la reproducci√≥n de video HTML5</div>
                                    <div style="font-size: 0.8rem; margin-top: 0.5rem; opacity: 0.8;">
                                        Intenta con Chrome, Firefox, Safari o Edge
                                    </div>
                                </div>
                            </video>
                            
                            <!-- Mensaje de error (oculto por defecto) -->
                            <div class="ext-video-error" style="display: none; padding: 2rem; background: rgba(220,53,69,0.2); border-radius: 8px; color: #dc3545; text-align: center;">
                                <div style="font-size: 2rem; margin-bottom: 1rem;">‚ùå</div>
                                <div style="font-weight: bold; margin-bottom: 0.5rem;">Error al cargar video externo ${videoFormat}</div>
                                <div style="font-size: 0.9rem; margin-bottom: 1rem;">
                                    URL: ${url.length > 50 ? url.substring(0, 50) + '...' : url}
                                </div>
                                <div style="font-size: 0.8rem; text-align: left; background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 6px; margin: 1rem 0;">
                                    ‚Ä¢ URL no accesible o servidor no disponible<br>
                                    ‚Ä¢ Formato ${videoFormat} no compatible con tu navegador<br>
                                    ‚Ä¢ Archivo corrupto o incompleto<br>
                                    ‚Ä¢ Restricciones CORS del servidor<br>
                                    ‚Ä¢ Conexi√≥n de internet lenta o interrumpida
                                </div>
                                <div style="font-size: 0.8rem; color: #87ceeb;">
                                    üí° Verifica que la URL sea correcta y accesible
                                </div>
                            </div>
                            
                            <!-- Informaci√≥n del video -->
                            <div style="position: absolute; top: 8px; left: 8px; background: rgba(0,0,0,0.8); color: #87ceeb; padding: 0.4rem 0.8rem; border-radius: 6px; font-size: 0.7rem; font-weight: bold; border: 1px solid #87ceeb;">
                                üé• ${videoFormat} Externo
                            </div>
                            
                            <!-- URL del video -->
                            <div style="position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.8); color: #87ceeb; padding: 0.4rem 0.8rem; border-radius: 6px; font-size: 0.7rem; font-weight: bold; border: 1px solid #87ceeb; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                üîó ${url.split('/').pop() || 'video.' + videoFormat.toLowerCase()}
                            </div>
                        </div>
                        
                        <!-- Estado del video -->
                        <div class="ext-video-status" style="margin-top: 1rem; font-size: 0.9rem; color: #87ceeb; opacity: 0.9; background: rgba(135, 206, 235, 0.1); padding: 0.6rem 1rem; border-radius: 8px; border: 1px solid rgba(135, 206, 235, 0.3); font-weight: bold;">
                            üìπ Video ${videoFormat} desde URL externa - Haz clic en ‚ñ∂Ô∏è para reproducir
                        </div>
                        
                        <!-- Informaci√≥n t√©cnica -->
                        <div style="margin-top: 0.5rem; font-size: 0.7rem; opacity: 0.7; text-align: center;">
                            üìä Formato: ${videoFormat} | üåê URL externa | üîß M√∫ltiples codecs soportados
                        </div>
                    </div>
                `;
            }
            
            // Fallback para enlaces no reconocidos
            return `
                <div style="background: rgba(0,0,0,0.5); padding: 2rem; border-radius: 8px; border: 2px dashed rgba(255, 215, 0, 0.5); text-align: center;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üé•</div>
                    <div style="color: #ffd700; font-weight: bold; margin-bottom: 0.5rem;">Video Enlazado</div>
                    <a href="${url}" target="_blank" rel="noopener noreferrer" style="color: #87ceeb; text-decoration: underline; word-break: break-all;">
                        ${url.length > 50 ? url.substring(0, 50) + '...' : url}
                    </a>
                    <div style="margin-top: 1rem; font-size: 0.9rem; opacity: 0.8;">
                        Haz clic para abrir en nueva pesta√±a
                    </div>
                </div>
            `;
        }

        // ========== FUNCIONES DE EVENTOS ==========
        
        function displayEvents() {
            const eventsContainer = document.getElementById('eventsList');
            
            if (events.length === 0) {
                eventsContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìÖ</div>
                        <div>No hay eventos programados</div>
                        <div style="margin-top: 1rem; font-size: 1rem; opacity: 0.8;">
                            ¬°Crea el primer evento de la compa√±√≠a!
                        </div>
                    </div>
                `;
                return;
            }

            let eventsHTML = '<div style="display: grid; gap: 1.5rem;">';

            // Ordenar eventos por fecha
            const sortedEvents = [...events].sort((a, b) => new Date(a.date + ' ' + a.time) - new Date(b.date + ' ' + b.time));

            sortedEvents.forEach(event => {
                const eventDate = new Date(event.date + ' ' + event.time);
                const now = new Date();
                const isPast = eventDate < now;
                const isToday = eventDate.toDateString() === now.toDateString();
                
                const typeIcons = {
                    'Misi√≥n': 'üéØ',
                    'Entrenamiento': 'üèãÔ∏è',
                    'Reuni√≥n': 'üë•',
                    'Ceremonia': 'üéñÔ∏è',
                    'Operaci√≥n Especial': '‚ö°'
                };

                eventsHTML += `
                    <div class="form-container" style="max-width: none; margin: 0; ${isPast ? 'opacity: 0.7;' : ''}">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <span style="font-size: 1.5rem;">${typeIcons[event.type] || 'üìÖ'}</span>
                                    <h3 style="color: #ffd700; margin: 0; font-size: 1.3rem;">${event.title}</h3>
                                    ${isPast ? '<span style="background: #dc3545; color: white; padding: 0.2rem 0.5rem; border-radius: 10px; font-size: 0.7rem;">PASADO</span>' : ''}
                                    ${isToday ? '<span style="background: #28a745; color: white; padding: 0.2rem 0.5rem; border-radius: 10px; font-size: 0.7rem;">HOY</span>' : ''}
                                </div>
                                <div style="color: #ffd700; font-weight: bold; margin-bottom: 0.5rem;">
                                    üìÖ ${formatDate(event.date)} - ‚è∞ ${event.time}
                                </div>
                                <div style="background: linear-gradient(45deg, #8b4513, #a0522d); color: #ffd700; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.9rem; font-weight: bold; border: 1px solid #ffd700; display: inline-block; margin-bottom: 1rem;">
                                    ${event.type}
                                </div>
                            </div>
                        </div>
                        <div style="line-height: 1.6;">
                            ${event.description}
                        </div>
                        <div style="margin-top: 1rem; font-size: 0.8rem; opacity: 0.7;">
                            Creado: ${formatDateTime(event.createdAt)}
                        </div>
                    </div>
                `;
            });

            eventsHTML += '</div>';
            eventsContainer.innerHTML = eventsHTML;
        }

        // ========== FUNCIONES DE TEMA ==========
        
        // Alternar tema d√≠a/noche
        function toggleTheme() {
            const body = document.body;
            const themeBtn = document.getElementById('themeBtn');
            
            if (body.classList.contains('night-mode')) {
                body.classList.remove('night-mode');
                body.classList.add('day-mode');
                themeBtn.innerHTML = '‚òÄÔ∏è Modo Noche';
            } else {
                body.classList.remove('day-mode');
                body.classList.add('night-mode');
                themeBtn.innerHTML = 'üåô Modo D√≠a';
            }
            
            saveNow('tema'); // Guardar preferencia de tema
        }

        // ========== FUNCIONES DE LIMPIEZA ==========
        
        // Limpiar todos los datos
        function clearAllData() {
            if (confirm('¬øEst√°s seguro de que quieres eliminar TODOS los datos? Esta acci√≥n no se puede deshacer.')) {
                if (confirm('Esta acci√≥n eliminar√° todos los miembros, multimedia y eventos. ¬øContinuar?')) {
                    // Limpiar localStorage
                    localStorage.removeItem('compania67_members');
                    localStorage.removeItem('compania67_multimedia');
                    localStorage.removeItem('compania67_events');
                    localStorage.removeItem('compania67_theme');
                    
                    // Resetear variables
                    members = [];
                    multimediaContent = [];
                    events = [];
                    
                    // Actualizar interfaz
                    displayMembers();
                    displayMultimedia();
                    displayEvents();
                    
                    alert('Todos los datos han sido eliminados exitosamente.');
                    showPage('inicio');
                }
            }
        }

        // ========== FUNCIONES DE FORMATO ==========
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric'
            };
            return date.toLocaleDateString('es-ES', options);
        }

        function formatDateTime(dateString) {
            const date = new Date(dateString);
            const options = { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            return date.toLocaleDateString('es-ES', options);
        }

        // ========== FUNCIONES DE MODAL DE IMAGEN ==========
        
        // Abrir modal para ver imagen en tama√±o completo
        function openImageModal(imageUrl, title) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                padding: 2rem;
                cursor: pointer;
            `;
            
            modal.innerHTML = `
                <div style="position: relative; max-width: 90%; max-height: 90%; text-align: center;">
                    <img src="${imageUrl}" 
                         alt="${title}" 
                         style="max-width: 100%; max-height: 100%; border-radius: 8px; box-shadow: 0 8px 32px rgba(0,0,0,0.5);">
                    <div style="position: absolute; top: -40px; right: 0; background: rgba(220,53,69,0.9); color: white; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; font-weight: bold;" onclick="event.stopPropagation(); closeImageModal()">
                        ‚úï
                    </div>
                    <div style="margin-top: 1rem; color: #ffd700; font-weight: bold; background: rgba(0,0,0,0.7); padding: 0.5rem 1rem; border-radius: 6px;">
                        ${title}
                    </div>
                    <div style="margin-top: 0.5rem; color: white; font-size: 0.8rem; opacity: 0.8;">
                        Haz clic fuera de la imagen para cerrar
                    </div>
                </div>
            `;
            
            // Cerrar modal al hacer clic fuera de la imagen
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeImageModal();
                }
            });
            
            // Cerrar modal con tecla Escape
            const handleEscape = function(e) {
                if (e.key === 'Escape') {
                    closeImageModal();
                }
            };
            document.addEventListener('keydown', handleEscape);
            
            // Funci√≥n para cerrar modal
            window.closeImageModal = function() {
                if (document.body.contains(modal)) {
                    document.body.removeChild(modal);
                }
                document.removeEventListener('keydown', handleEscape);
                delete window.closeImageModal;
            };
            
            document.body.appendChild(modal);
        }

        // ========== FUNCIONES DE MANEJO DE ARCHIVOS ==========
        
        // Alternar entre m√©todos de foto
        function togglePhotoMethod(method) {
            const fileSection = document.getElementById('fileUploadSection');
            const urlSection = document.getElementById('urlUploadSection');
            
            if (method === 'file') {
                fileSection.style.display = 'block';
                urlSection.style.display = 'none';
            } else {
                fileSection.style.display = 'none';
                urlSection.style.display = 'block';
                clearImagePreview(); // Limpiar vista previa al cambiar a URL
            }
        }
        
        // Alternar entre m√©todos de multimedia
        function toggleMediaMethod(method) {
            const fileSection = document.getElementById('mediaFileUploadSection');
            const urlSection = document.getElementById('mediaUrlUploadSection');
            
            if (method === 'file') {
                fileSection.style.display = 'block';
                urlSection.style.display = 'none';
            } else {
                fileSection.style.display = 'none';
                urlSection.style.display = 'block';
                clearMediaPreview(); // Limpiar vista previa al cambiar a URL
            }
        }
        
        // Manejar selecci√≥n de archivo
        function handleFileSelect(input) {
            const file = input.files[0];
            if (!file) {
                clearImagePreview();
                return;
            }
            
            // Validar tipo de archivo
            if (!file.type.startsWith('image/')) {
                alert('Por favor selecciona un archivo de imagen v√°lido.');
                input.value = '';
                clearImagePreview();
                return;
            }
            
            // Validar tama√±o (5MB m√°ximo)
            const maxSize = 5 * 1024 * 1024; // 5MB en bytes
            if (file.size > maxSize) {
                alert('La imagen es demasiado grande. Por favor selecciona una imagen menor a 5MB.');
                input.value = '';
                clearImagePreview();
                return;
            }
            
            // Mostrar indicador de carga
            showImageLoadingIndicator();
            
            // Leer archivo como base64
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    // Redimensionar imagen si es muy grande
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // Calcular nuevas dimensiones (m√°ximo 800x800)
                    let { width, height } = img;
                    const maxDimension = 800;
                    
                    if (width > maxDimension || height > maxDimension) {
                        if (width > height) {
                            height = (height * maxDimension) / width;
                            width = maxDimension;
                        } else {
                            width = (width * maxDimension) / height;
                            height = maxDimension;
                        }
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    // Dibujar imagen redimensionada
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Convertir a base64 con calidad optimizada
                    const optimizedDataUrl = canvas.toDataURL('image/jpeg', 0.8);
                    
                    // Mostrar vista previa
                    showImagePreview(optimizedDataUrl, file.name);
                    
                    console.log(`üì∑ Imagen procesada: ${file.name} (${(optimizedDataUrl.length / 1024).toFixed(1)}KB)`);
                };
                
                img.onerror = function() {
                    alert('Error al procesar la imagen. Por favor intenta con otra imagen.');
                    input.value = '';
                    clearImagePreview();
                };
                
                img.src = e.target.result;
            };
            
            reader.onerror = function() {
                alert('Error al leer el archivo. Por favor intenta de nuevo.');
                input.value = '';
                clearImagePreview();
            };
            
            reader.readAsDataURL(file);
        }
        
        // Mostrar indicador de carga
        function showImageLoadingIndicator() {
            const preview = document.getElementById('imagePreview');
            preview.style.display = 'block';
            preview.innerHTML = `
                <div style="display: inline-block; position: relative;">
                    <div style="width: 100px; height: 100px; border-radius: 50%; border: 3px solid #ffd700; background: rgba(255, 215, 0, 0.1); display: flex; align-items: center; justify-content: center; color: #ffd700; font-size: 2rem;">
                        <div style="animation: spin 1s linear infinite;">‚è≥</div>
                    </div>
                </div>
                <div style="margin-top: 0.5rem; font-size: 0.8rem; color: #ffd700;">Procesando imagen...</div>
                <style>
                    @keyframes spin {
                        from { transform: rotate(0deg); }
                        to { transform: rotate(360deg); }
                    }
                </style>
            `;
        }
        
        // Mostrar vista previa de imagen
        function showImagePreview(dataUrl, fileName) {
            const preview = document.getElementById('imagePreview');
            const previewImg = document.getElementById('previewImg');
            
            preview.style.display = 'block';
            preview.innerHTML = `
                <div style="display: inline-block; position: relative;">
                    <img id="previewImg" src="${dataUrl}" style="width: 100px; height: 100px; object-fit: cover; border-radius: 50%; border: 3px solid #ffd700; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);">
                    <button type="button" onclick="clearImagePreview()" style="position: absolute; top: -5px; right: -5px; width: 25px; height: 25px; border-radius: 50%; background: #dc3545; color: white; border: none; cursor: pointer; font-size: 0.8rem; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">‚úï</button>
                </div>
                <div style="margin-top: 0.5rem; font-size: 0.8rem; color: #ffd700;">
                    ‚úÖ ${fileName || 'Imagen cargada'}<br>
                    <span style="opacity: 0.7; font-size: 0.7rem;">${(dataUrl.length / 1024).toFixed(1)}KB</span>
                </div>
            `;
        }
        
        // Limpiar vista previa
        function clearImagePreview() {
            const preview = document.getElementById('imagePreview');
            const fileInput = document.getElementById('fotoPerfilFile');
            
            preview.style.display = 'none';
            preview.innerHTML = `
                <div style="display: inline-block; position: relative;">
                    <img id="previewImg" style="width: 100px; height: 100px; object-fit: cover; border-radius: 50%; border: 3px solid #ffd700; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);">
                    <button type="button" onclick="clearImagePreview()" style="position: absolute; top: -5px; right: -5px; width: 25px; height: 25px; border-radius: 50%; background: #dc3545; color: white; border: none; cursor: pointer; font-size: 0.8rem; display: flex; align-items: center; justify-content: center;">‚úï</button>
                </div>
                <div style="margin-top: 0.5rem; font-size: 0.8rem; color: #ffd700;">Vista previa</div>
            `;
            
            if (fileInput) {
                fileInput.value = '';
            }
        }
        
        // ========== FUNCIONES DE MULTIMEDIA ==========
        
        // Editar post multimedia
        function editMultimediaPost(postId) {
            const post = multimediaContent.find(p => p.id === postId);
            if (!post) {
                alert('Post no encontrado');
                return;
            }
            
            // Crear modal de edici√≥n
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                padding: 2rem;
                overflow-y: auto;
            `;
            
            const typeIcons = {
                'Foto': 'üì∑',
                'Video': 'üé•',
                'Informaci√≥n': 'üìù',
                'Misi√≥n': 'üéØ'
            };
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #2d4a2b, #3d5a3b); padding: 2rem; border-radius: 12px; border: 2px solid #ffd700; max-width: 700px; width: 100%; max-height: 90vh; overflow-y: auto; color: #e8f5e8;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 style="color: #ffd700; margin: 0;">‚úèÔ∏è Editar Post: ${post.title}</h2>
                        <button onclick="closeEditMultimediaModal()" style="background: #dc3545; color: white; border: none; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center;">‚úï</button>
                    </div>
                    
                    <form id="editMultimediaForm">
                        <div style="display: grid; gap: 1.5rem;">
                            <div>
                                <label style="display: block; color: #ffd700; margin-bottom: 0.5rem; font-weight: bold;">T√≠tulo del Post:</label>
                                <input type="text" id="editPostTitle" value="${post.title}" required style="width: 100%; padding: 0.8rem; border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 6px; background: rgba(0,0,0,0.3); color: #e8f5e8; font-size: 1rem;">
                            </div>
                            
                            <div>
                                <label style="display: block; color: #ffd700; margin-bottom: 0.5rem; font-weight: bold;">Tipo de Contenido:</label>
                                <select id="editPostType" required style="width: 100%; padding: 0.8rem; border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 6px; background: rgba(0,0,0,0.3); color: #e8f5e8; font-size: 1rem;">
                                    <option value="Foto" ${post.type === 'Foto' ? 'selected' : ''}>üì∑ Foto</option>
                                    <option value="Video" ${post.type === 'Video' ? 'selected' : ''}>üé• Video</option>
                                    <option value="Informaci√≥n" ${post.type === 'Informaci√≥n' ? 'selected' : ''}>üìù Informaci√≥n</option>
                                    <option value="Misi√≥n" ${post.type === 'Misi√≥n' ? 'selected' : ''}>üéØ Reporte de Misi√≥n</option>
                                </select>
                            </div>
                            
                            <div>
                                <label style="display: block; color: #ffd700; margin-bottom: 0.5rem; font-weight: bold;">üìÅ Contenido Multimedia:</label>
                                
                                <!-- Vista previa del contenido actual -->
                                ${post.mediaUrl ? `
                                    <div style="margin-bottom: 1rem; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px; border: 2px solid rgba(255, 215, 0, 0.3);">
                                        <div style="color: #ffd700; font-weight: bold; margin-bottom: 0.5rem;">üì∑ Contenido Actual:</div>
                                        <div style="text-align: center; margin-bottom: 1rem;">
                                            ${(() => {
                                                if (post.mediaUrl.startsWith('data:image/')) {
                                                    return `<img src="${post.mediaUrl}" style="max-width: 200px; max-height: 150px; object-fit: cover; border-radius: 8px; border: 2px solid #ffd700;">`;
                                                } else if (post.mediaUrl.startsWith('data:video/')) {
                                                    return `<video controls style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 2px solid #ffd700;"><source src="${post.mediaUrl}"></video>`;
                                                } else if (isImageUrl(post.mediaUrl)) {
                                                    return `<img src="${post.mediaUrl}" style="max-width: 200px; max-height: 150px; object-fit: cover; border-radius: 8px; border: 2px solid #ffd700;" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"><div style="display: none; color: #dc3545;">‚ùå Error al cargar imagen</div>`;
                                                } else {
                                                    return `<div style="padding: 1rem; background: rgba(0,0,0,0.3); border-radius: 6px; color: #87ceeb;">üîó ${post.mediaUrl.length > 40 ? post.mediaUrl.substring(0, 40) + '...' : post.mediaUrl}</div>`;
                                                }
                                            })()}
                                        </div>
                                        <div style="font-size: 0.8rem; opacity: 0.8; text-align: center;">
                                            ${post.fileName ? `üìÅ ${post.fileName}` : 'üîó Contenido externo'}
                                        </div>
                                    </div>
                                ` : ''}
                                
                                <!-- Selector de m√©todo -->
                                <div style="display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; background: rgba(255, 215, 0, 0.1); padding: 0.5rem 1rem; border-radius: 6px; border: 2px solid rgba(255, 215, 0, 0.3);">
                                        <input type="radio" name="editMediaMethod" value="file" ${post.mediaMethod === 'file' ? 'checked' : ''} onchange="toggleEditMediaMethod('file')" style="margin: 0;">
                                        üìÅ Subir Nuevo Archivo
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; background: rgba(255, 215, 0, 0.1); padding: 0.5rem 1rem; border-radius: 6px; border: 2px solid rgba(255, 215, 0, 0.3);">
                                        <input type="radio" name="editMediaMethod" value="url" ${post.mediaMethod === 'url' ? 'checked' : ''} onchange="toggleEditMediaMethod('url')" style="margin: 0;">
                                        üîó URL Externa
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; background: rgba(255, 215, 0, 0.1); padding: 0.5rem 1rem; border-radius: 6px; border: 2px solid rgba(255, 215, 0, 0.3);">
                                        <input type="radio" name="editMediaMethod" value="keep" checked onchange="toggleEditMediaMethod('keep')" style="margin: 0;">
                                        ‚úÖ Mantener Actual
                                    </label>
                                </div>
                                
                                <!-- Subir archivo -->
                                <div id="editMediaFileUploadSection" style="display: none;">
                                    <input type="file" id="editMediaFile" accept="image/*,video/*" onchange="handleEditMediaFileSelect(this)" style="width: 100%; padding: 0.8rem; border: 2px dashed rgba(255, 215, 0, 0.5); border-radius: 6px; background: rgba(0,0,0,0.3); color: inherit; font-size: 1rem; cursor: pointer;">
                                    <small style="opacity: 0.7; font-size: 0.8rem; display: block; margin-top: 0.5rem;">
                                        üì∑ Im√°genes: .jpg, .png, .gif, .webp (m√°x. 10MB)<br>
                                        üé• Videos: .mp4, .webm, .mov, .avi (m√°x. 50MB)
                                    </small>
                                    
                                    <!-- Vista previa nueva -->
                                    <div id="editMediaPreview" style="display: none; margin-top: 1rem; text-align: center;">
                                        <div style="display: inline-block; position: relative; max-width: 300px;">
                                            <div id="editMediaPreviewContent"></div>
                                            <button type="button" onclick="clearEditMediaPreview()" style="position: absolute; top: -5px; right: -5px; width: 30px; height: 30px; border-radius: 50%; background: #dc3545; color: white; border: none; cursor: pointer; font-size: 1rem; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">‚úï</button>
                                        </div>
                                        <div id="editMediaPreviewInfo" style="margin-top: 0.5rem; font-size: 0.8rem; color: #ffd700;"></div>
                                    </div>
                                </div>
                                
                                <!-- URL externa -->
                                <div id="editMediaUrlUploadSection" style="display: none;">
                                    <input type="url" id="editMediaUrl" value="${post.mediaMethod === 'url' ? post.mediaUrl || '' : ''}" placeholder="https://ejemplo.com/imagen.jpg o https://youtube.com/watch?v=..." style="width: 100%; padding: 0.8rem; border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 6px; background: rgba(0,0,0,0.3); color: inherit; font-size: 1rem;">
                                    <small style="opacity: 0.7; font-size: 0.8rem; display: block; margin-top: 0.5rem;">
                                        üì∑ Para im√°genes: URL directa (.jpg, .png, .gif)<br>
                                        üé• Para videos: YouTube, Vimeo, o URL directa
                                    </small>
                                </div>
                            </div>
                            
                            <div>
                                <label style="display: block; color: #ffd700; margin-bottom: 0.5rem; font-weight: bold;">Descripci√≥n:</label>
                                <textarea id="editPostDescription" rows="4" required placeholder="Describe tu momento, misi√≥n o informaci√≥n..." style="width: 100%; padding: 0.8rem; border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 6px; background: rgba(0,0,0,0.3); color: #e8f5e8; font-size: 1rem; resize: vertical;">${post.description}</textarea>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                            <button type="button" onclick="closeEditMultimediaModal()" style="flex: 1; background: #6c757d; color: white; border: none; padding: 1rem; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: bold;">
                                Cancelar
                            </button>
                            <button type="submit" style="flex: 1; background: linear-gradient(45deg, #28a745, #20c997); color: white; border: none; padding: 1rem; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: bold;">
                                üíæ Guardar Cambios
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Manejar env√≠o del formulario de edici√≥n
            document.getElementById('editMultimediaForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Obtener contenido multimedia seg√∫n el m√©todo seleccionado
                let mediaContent = post.mediaUrl; // Mantener actual por defecto
                let mediaType = post.mediaType;
                let fileName = post.fileName;
                
                const mediaMethod = document.querySelector('input[name="editMediaMethod"]:checked').value;
                
                if (mediaMethod === 'file') {
                    // Usar nuevo archivo si se subi√≥
                    const mediaPreviewContent = document.getElementById('editMediaPreviewContent');
                    if (mediaPreviewContent && mediaPreviewContent.innerHTML.trim()) {
                        const img = mediaPreviewContent.querySelector('img');
                        const video = mediaPreviewContent.querySelector('video source');
                        
                        if (img && img.src && img.src.startsWith('data:')) {
                            mediaContent = img.src;
                            mediaType = 'image';
                            fileName = document.getElementById('editMediaFile').files[0]?.name || 'imagen.jpg';
                        } else if (video && video.src && video.src.startsWith('data:')) {
                            mediaContent = video.src;
                            mediaType = 'video';
                            fileName = document.getElementById('editMediaFile').files[0]?.name || 'video.mp4';
                        }
                    }
                } else if (mediaMethod === 'url') {
                    // Usar nueva URL
                    mediaContent = document.getElementById('editMediaUrl').value || null;
                    mediaType = 'url';
                    fileName = null;
                }
                // Si es 'keep', mantener los valores actuales
                
                // Actualizar datos del post
                const postIndex = multimediaContent.findIndex(p => p.id === postId);
                if (postIndex !== -1) {
                    multimediaContent[postIndex] = {
                        ...post,
                        title: document.getElementById('editPostTitle').value,
                        type: document.getElementById('editPostType').value,
                        mediaUrl: mediaContent,
                        mediaType: mediaType,
                        fileName: fileName,
                        mediaMethod: mediaMethod === 'keep' ? post.mediaMethod : mediaMethod,
                        description: document.getElementById('editPostDescription').value,
                        lastModified: new Date().toISOString()
                    };
                    
                    // Guardar cambios
                    saveNow('edicion_multimedia').then(() => {
                        showSaveIndicator(`‚úÖ Post "${multimediaContent[postIndex].title}" actualizado exitosamente`);
                        displayMultimedia(); // Actualizar vista
                        closeEditMultimediaModal();
                    });
                }
            });
            
            // Funci√≥n para cerrar modal
            window.closeEditMultimediaModal = function() {
                if (document.body.contains(modal)) {
                    document.body.removeChild(modal);
                }
                delete window.closeEditMultimediaModal;
                delete window.toggleEditMediaMethod;
                delete window.handleEditMediaFileSelect;
                delete window.clearEditMediaPreview;
            };
            
            // Funci√≥n para alternar m√©todo de multimedia en edici√≥n
            window.toggleEditMediaMethod = function(method) {
                const fileSection = document.getElementById('editMediaFileUploadSection');
                const urlSection = document.getElementById('editMediaUrlUploadSection');
                
                if (method === 'file') {
                    fileSection.style.display = 'block';
                    urlSection.style.display = 'none';
                } else if (method === 'url') {
                    fileSection.style.display = 'none';
                    urlSection.style.display = 'block';
                    clearEditMediaPreview();
                } else { // keep
                    fileSection.style.display = 'none';
                    urlSection.style.display = 'none';
                    clearEditMediaPreview();
                }
            };
            
            // Funci√≥n para manejar archivo en edici√≥n
            window.handleEditMediaFileSelect = function(input) {
                const file = input.files[0];
                if (!file) {
                    clearEditMediaPreview();
                    return;
                }
                
                // Validar tipo de archivo
                const isImage = file.type.startsWith('image/');
                const isVideo = file.type.startsWith('video/');
                
                if (!isImage && !isVideo) {
                    alert('Por favor selecciona un archivo de imagen o video v√°lido.');
                    input.value = '';
                    clearEditMediaPreview();
                    return;
                }
                
                // Validar tama√±o seg√∫n tipo
                const maxImageSize = 10 * 1024 * 1024; // 10MB para im√°genes
                const maxVideoSize = 50 * 1024 * 1024; // 50MB para videos
                const maxSize = isImage ? maxImageSize : maxVideoSize;
                
                if (file.size > maxSize) {
                    const maxSizeMB = isImage ? '10MB' : '50MB';
                    alert(`El archivo es demasiado grande. Por favor selecciona un ${isImage ? 'imagen' : 'video'} menor a ${maxSizeMB}.`);
                    input.value = '';
                    clearEditMediaPreview();
                    return;
                }
                
                // Mostrar indicador de carga
                showEditMediaLoadingIndicator(isImage ? 'imagen' : 'video');
                
                // Procesar archivo
                const reader = new FileReader();
                reader.onload = function(e) {
                    if (isImage) {
                        processEditImageFile(e.target.result, file);
                    } else {
                        processEditVideoFile(e.target.result, file);
                    }
                };
                
                reader.onerror = function() {
                    alert('Error al leer el archivo. Por favor intenta de nuevo.');
                    input.value = '';
                    clearEditMediaPreview();
                };
                
                reader.readAsDataURL(file);
            };
            
            // Funciones auxiliares para edici√≥n
            function showEditMediaLoadingIndicator(type) {
                const preview = document.getElementById('editMediaPreview');
                const icon = type === 'imagen' ? 'üì∑' : 'üé•';
                
                preview.style.display = 'block';
                document.getElementById('editMediaPreviewContent').innerHTML = `
                    <div style="width: 200px; height: 150px; border-radius: 8px; border: 3px solid #ffd700; background: rgba(255, 215, 0, 0.1); display: flex; align-items: center; justify-content: center; color: #ffd700; font-size: 3rem;">
                        <div style="animation: spin 1s linear infinite;">${icon}</div>
                    </div>
                `;
                document.getElementById('editMediaPreviewInfo').innerHTML = `Procesando ${type}...`;
            }
            
            function processEditImageFile(dataUrl, file) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    let { width, height } = img;
                    const maxDimension = 1200;
                    
                    if (width > maxDimension || height > maxDimension) {
                        if (width > height) {
                            height = (height * maxDimension) / width;
                            width = maxDimension;
                        } else {
                            width = (width * maxDimension) / height;
                            height = maxDimension;
                        }
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    const optimizedDataUrl = canvas.toDataURL('image/jpeg', 0.85);
                    showEditMediaPreview(optimizedDataUrl, file, 'image');
                };
                
                img.onerror = function() {
                    alert('Error al procesar la imagen. Por favor intenta con otra imagen.');
                    document.getElementById('editMediaFile').value = '';
                    clearEditMediaPreview();
                };
                
                img.src = dataUrl;
            }
            
            function processEditVideoFile(dataUrl, file) {
                if (file.size > 20 * 1024 * 1024) {
                    if (!confirm(`El video es grande (${(file.size / 1024 / 1024).toFixed(1)}MB). Esto puede afectar el rendimiento. ¬øContinuar?`)) {
                        document.getElementById('editMediaFile').value = '';
                        clearEditMediaPreview();
                        return;
                    }
                }
                
                showEditMediaPreview(dataUrl, file, 'video');
            }
            
            function showEditMediaPreview(dataUrl, file, type) {
                const preview = document.getElementById('editMediaPreview');
                const content = document.getElementById('editMediaPreviewContent');
                const info = document.getElementById('editMediaPreviewInfo');
                
                preview.style.display = 'block';
                
                if (type === 'image') {
                    content.innerHTML = `
                        <img src="${dataUrl}" 
                             style="max-width: 200px; max-height: 150px; object-fit: cover; border-radius: 8px; border: 3px solid #ffd700; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);">
                    `;
                    info.innerHTML = `
                        ‚úÖ ${file.name}<br>
                        <span style="opacity: 0.7; font-size: 0.7rem;">üì∑ Nueva imagen - ${(dataUrl.length / 1024).toFixed(1)}KB</span>
                    `;
                } else if (type === 'video') {
                    content.innerHTML = `
                        <video controls style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 3px solid #ffd700; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);">
                            <source src="${dataUrl}" type="${file.type}">
                            Tu navegador no soporta la reproducci√≥n de video.
                        </video>
                    `;
                    info.innerHTML = `
                        ‚úÖ ${file.name}<br>
                        <span style="opacity: 0.7; font-size: 0.7rem;">üé• Nuevo video - ${(file.size / 1024 / 1024).toFixed(1)}MB</span>
                    `;
                }
            }
            
            // Funci√≥n para limpiar vista previa en edici√≥n
            window.clearEditMediaPreview = function() {
                const preview = document.getElementById('editMediaPreview');
                const fileInput = document.getElementById('editMediaFile');
                
                preview.style.display = 'none';
                document.getElementById('editMediaPreviewContent').innerHTML = '';
                document.getElementById('editMediaPreviewInfo').innerHTML = '';
                
                if (fileInput) {
                    fileInput.value = '';
                }
            };
        }
        
        // Eliminar post multimedia
        function deleteMultimediaPost(postId, postTitle, postType) {
            if (confirm(`¬øEst√°s seguro de que quieres eliminar el post "${postTitle}"?`)) {
                if (confirm(`Esta acci√≥n eliminar√° permanentemente el post de tipo "${postType}". ¬øContinuar?`)) {
                    const postIndex = multimediaContent.findIndex(p => p.id === postId);
                    if (postIndex !== -1) {
                        multimediaContent.splice(postIndex, 1);
                        
                        saveNow('eliminacion_multimedia').then(() => {
                            showSaveIndicator(`‚úÖ Post "${postTitle}" eliminado exitosamente`);
                            displayMultimedia(); // Actualizar vista
                        });
                    }
                }
            }
        }
        
        // Manejar selecci√≥n de archivo multimedia
        function handleMediaFileSelect(input) {
            const file = input.files[0];
            if (!file) {
                clearMediaPreview();
                return;
            }
            
            // Validar tipo de archivo
            const isImage = file.type.startsWith('image/');
            const isVideo = file.type.startsWith('video/');
            
            if (!isImage && !isVideo) {
                alert('Por favor selecciona un archivo de imagen o video v√°lido.');
                input.value = '';
                clearMediaPreview();
                return;
            }
            
            // Validar tama√±o seg√∫n tipo
            const maxImageSize = 10 * 1024 * 1024; // 10MB para im√°genes
            const maxVideoSize = 50 * 1024 * 1024; // 50MB para videos
            const maxSize = isImage ? maxImageSize : maxVideoSize;
            
            if (file.size > maxSize) {
                const maxSizeMB = isImage ? '10MB' : '50MB';
                alert(`El archivo es demasiado grande. Por favor selecciona un ${isImage ? 'imagen' : 'video'} menor a ${maxSizeMB}.`);
                input.value = '';
                clearMediaPreview();
                return;
            }
            
            // Mostrar indicador de carga
            showMediaLoadingIndicator(isImage ? 'imagen' : 'video');
            
            // Procesar archivo
            const reader = new FileReader();
            reader.onload = function(e) {
                if (isImage) {
                    processImageFile(e.target.result, file);
                } else {
                    processVideoFile(e.target.result, file);
                }
            };
            
            reader.onerror = function() {
                alert('Error al leer el archivo. Por favor intenta de nuevo.');
                input.value = '';
                clearMediaPreview();
            };
            
            reader.readAsDataURL(file);
        }
        
        // Procesar archivo de imagen
        function processImageFile(dataUrl, file) {
            const img = new Image();
            img.onload = function() {
                // Redimensionar imagen si es muy grande
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Calcular nuevas dimensiones (m√°ximo 1200x1200 para multimedia)
                let { width, height } = img;
                const maxDimension = 1200;
                
                if (width > maxDimension || height > maxDimension) {
                    if (width > height) {
                        height = (height * maxDimension) / width;
                        width = maxDimension;
                    } else {
                        width = (width * maxDimension) / height;
                        height = maxDimension;
                    }
                }
                
                canvas.width = width;
                canvas.height = height;
                
                // Dibujar imagen redimensionada
                ctx.drawImage(img, 0, 0, width, height);
                
                // Convertir a base64 con calidad optimizada
                const optimizedDataUrl = canvas.toDataURL('image/jpeg', 0.85);
                
                // Mostrar vista previa
                showMediaPreview(optimizedDataUrl, file, 'image');
                
                console.log(`üì∑ Imagen multimedia procesada: ${file.name} (${(optimizedDataUrl.length / 1024).toFixed(1)}KB)`);
            };
            
            img.onerror = function() {
                alert('Error al procesar la imagen. Por favor intenta con otra imagen.');
                document.getElementById('mediaFile').value = '';
                clearMediaPreview();
            };
            
            img.src = dataUrl;
        }
        
        // Procesar archivo de video
        function processVideoFile(dataUrl, file) {
            // Para videos, guardamos el archivo completo en base64
            // Nota: Los videos grandes pueden causar problemas de memoria
            if (file.size > 20 * 1024 * 1024) { // 20MB
                // Para videos muy grandes, mostrar advertencia pero permitir
                if (!confirm(`El video es grande (${(file.size / 1024 / 1024).toFixed(1)}MB). Esto puede afectar el rendimiento. ¬øContinuar?`)) {
                    document.getElementById('mediaFile').value = '';
                    clearMediaPreview();
                    return;
                }
            }
            
            // Mostrar vista previa del video
            showMediaPreview(dataUrl, file, 'video');
            
            console.log(`üé• Video multimedia procesado: ${file.name} (${(file.size / 1024 / 1024).toFixed(1)}MB)`);
        }
        
        // Mostrar indicador de carga multimedia
        function showMediaLoadingIndicator(type) {
            const preview = document.getElementById('mediaPreview');
            const icon = type === 'imagen' ? 'üì∑' : 'üé•';
            
            preview.style.display = 'block';
            document.getElementById('mediaPreviewContent').innerHTML = `
                <div style="width: 200px; height: 150px; border-radius: 8px; border: 3px solid #ffd700; background: rgba(255, 215, 0, 0.1); display: flex; align-items: center; justify-content: center; color: #ffd700; font-size: 3rem;">
                    <div style="animation: spin 1s linear infinite;">${icon}</div>
                </div>
                <style>
                    @keyframes spin {
                        from { transform: rotate(0deg); }
                        to { transform: rotate(360deg); }
                    }
                </style>
            `;
            document.getElementById('mediaPreviewInfo').innerHTML = `Procesando ${type}...`;
        }
        
        // Mostrar vista previa multimedia
        function showMediaPreview(dataUrl, file, type) {
            const preview = document.getElementById('mediaPreview');
            const content = document.getElementById('mediaPreviewContent');
            const info = document.getElementById('mediaPreviewInfo');
            
            preview.style.display = 'block';
            
            if (type === 'image') {
                content.innerHTML = `
                    <img src="${dataUrl}" 
                         style="max-width: 200px; max-height: 150px; object-fit: cover; border-radius: 8px; border: 3px solid #ffd700; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);">
                `;
                info.innerHTML = `
                    ‚úÖ ${file.name}<br>
                    <span style="opacity: 0.7; font-size: 0.7rem;">üì∑ Imagen - ${(dataUrl.length / 1024).toFixed(1)}KB</span>
                `;
            } else if (type === 'video') {
                content.innerHTML = `
                    <video controls style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 3px solid #ffd700; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);">
                        <source src="${dataUrl}" type="${file.type}">
                        Tu navegador no soporta la reproducci√≥n de video.
                    </video>
                `;
                info.innerHTML = `
                    ‚úÖ ${file.name}<br>
                    <span style="opacity: 0.7; font-size: 0.7rem;">üé• Video - ${(file.size / 1024 / 1024).toFixed(1)}MB</span>
                `;
            }
        }
        
        // Limpiar vista previa multimedia
        function clearMediaPreview() {
            const preview = document.getElementById('mediaPreview');
            const fileInput = document.getElementById('mediaFile');
            
            preview.style.display = 'none';
            document.getElementById('mediaPreviewContent').innerHTML = '';
            document.getElementById('mediaPreviewInfo').innerHTML = '';
            
            if (fileInput) {
                fileInput.value = '';
            }
        }

        // ========== INICIALIZACI√ìN ==========
        
        // INICIALIZACI√ìN COMPLETA DEL SISTEMA
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Iniciando Compa√±√≠a Maldita 67 - Sistema de Auto-Guardado v3.0');
            
            // Cargar TODOS los datos de una vez
            const loadSuccess = loadAllData();
            
            if (loadSuccess) {
                console.log('‚úÖ Sistema iniciado correctamente');
                showSaveIndicator('üéØ Sistema cargado - Guardado autom√°tico activo');
            } else {
                console.log('‚ö†Ô∏è Sistema iniciado con datos por defecto');
                showSaveIndicator('‚ö†Ô∏è Datos inicializados - Guardado autom√°tico activo', true);
            }

            // Verificar integridad de datos al cargar
            checkDataIntegrity();

            // Formulario de registro de miembros MEJORADO
            const registroForm = document.getElementById('registroForm');
            if (registroForm) {
                registroForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(registroForm);
                    
                    // Obtener foto de perfil seg√∫n el m√©todo seleccionado
                    let profilePhoto = null;
                    const photoMethod = document.querySelector('input[name="photoMethod"]:checked').value;
                    
                    if (photoMethod === 'file') {
                        // Usar la imagen convertida a base64 si existe
                        const previewImg = document.getElementById('previewImg');
                        if (previewImg && previewImg.src && previewImg.src.startsWith('data:')) {
                            profilePhoto = previewImg.src;
                        }
                    } else {
                        // Usar URL externa
                        profilePhoto = formData.get('fotoPerfil') || null;
                    }
                    
                    const newMember = {
                        id: Date.now(),
                        name: formData.get('nombre'),
                        age: parseInt(formData.get('edad')),
                        nationality: formData.get('nacionalidad'),
                        rank: formData.get('rango'),
                        specialty: formData.get('especialidad'),
                        discord: formData.get('discord'),
                        profilePhoto: profilePhoto,
                        photoMethod: photoMethod,
                        registeredAt: new Date().toISOString(),
                        sessionId: sessionId
                    };
                    
                    // Agregar miembro y guardar autom√°ticamente
                    members.push(newMember);
                    
                    // Guardado inmediato con raz√≥n espec√≠fica
                    saveNow('registro').then(() => {
                        console.log(`üéØ Miembro ${newMember.name} registrado y guardado exitosamente`);
                        
                        // Limpiar formulario y vista previa
                        registroForm.reset();
                        clearImagePreview();
                        
                        // Resetear m√©todo de foto a archivo
                        document.querySelector('input[name="photoMethod"][value="file"]').checked = true;
                        togglePhotoMethod('file');
                        
                        // Actualizar vista autom√°ticamente
                        setTimeout(() => {
                            showPage('miembros');
                        }, 1500);
                        
                    }).catch(error => {
                        console.error('‚ùå Error guardando miembro:', error);
                        showSaveIndicator('‚ùå Error al guardar miembro - Reintentando...', true);
                        
                        // Reintentar guardado
                        setTimeout(() => {
                            saveNow('registro_retry');
                        }, 2000);
                    });
                });
                
                // Auto-guardado mientras se escribe (cada 3 segundos)
                const formInputs = registroForm.querySelectorAll('input, select');
                formInputs.forEach(input => {
                    let inputTimeout;
                    input.addEventListener('input', function() {
                        clearTimeout(inputTimeout);
                        inputTimeout = setTimeout(() => {
                            smartSave('formulario_cambio');
                        }, 3000);
                    });
                });
            }

            // Formulario de eventos MEJORADO
            const eventForm = document.getElementById('eventForm');
            if (eventForm) {
                eventForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(eventForm);
                    
                    const newEvent = {
                        id: Date.now(),
                        title: formData.get('eventTitle'),
                        date: formData.get('eventDate'),
                        time: formData.get('eventTime'),
                        type: formData.get('eventType'),
                        description: formData.get('eventDescription'),
                        createdAt: new Date().toISOString(),
                        sessionId: sessionId
                    };
                    
                    // Agregar evento y guardar autom√°ticamente
                    events.push(newEvent);
                    
                    // Guardado inmediato con raz√≥n espec√≠fica
                    saveNow('evento').then(() => {
                        console.log(`üéØ Evento "${newEvent.title}" creado y guardado exitosamente`);
                        displayEvents(); // Actualizar vista inmediatamente
                        eventForm.reset();
                    }).catch(error => {
                        console.error('‚ùå Error guardando evento:', error);
                        showSaveIndicator('‚ùå Error al guardar evento - Reintentando...', true);
                        setTimeout(() => saveNow('evento_retry'), 2000);
                    });
                });
                
                // Auto-guardado mientras se escribe
                const eventInputs = eventForm.querySelectorAll('input, select, textarea');
                eventInputs.forEach(input => {
                    let inputTimeout;
                    input.addEventListener('input', function() {
                        clearTimeout(inputTimeout);
                        inputTimeout = setTimeout(() => {
                            smartSave('evento_cambio');
                        }, 3000);
                    });
                });
            }

            // Formulario de multimedia MEJORADO
            const multimediaForm = document.getElementById('multimediaForm');
            if (multimediaForm) {
                multimediaForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(multimediaForm);
                    
                    // Obtener contenido multimedia seg√∫n el m√©todo seleccionado
                    let mediaContent = null;
                    let mediaType = null;
                    let fileName = null;
                    
                    const mediaMethod = document.querySelector('input[name="mediaMethod"]:checked').value;
                    
                    if (mediaMethod === 'file') {
                        // Verificar si hay vista previa primero
                        const mediaPreviewContent = document.getElementById('mediaPreviewContent');
                        if (mediaPreviewContent && mediaPreviewContent.innerHTML.trim()) {
                            const img = mediaPreviewContent.querySelector('img');
                            const video = mediaPreviewContent.querySelector('video source');
                            
                            if (img && img.src && img.src.startsWith('data:')) {
                                mediaContent = img.src;
                                mediaType = 'image';
                                fileName = document.getElementById('mediaFile').files[0]?.name || 'imagen.jpg';
                            } else if (video && video.src && video.src.startsWith('data:')) {
                                mediaContent = video.src;
                                mediaType = 'video';
                                fileName = document.getElementById('mediaFile').files[0]?.name || 'video.mp4';
                            }
                        }
                        
                        // Si no hay vista previa pero hay archivo seleccionado, procesarlo directamente
                        if (!mediaContent) {
                            const fileInput = document.getElementById('mediaFile');
                            if (fileInput && fileInput.files && fileInput.files[0]) {
                                const file = fileInput.files[0];
                                
                                // Procesar archivo de forma s√≠ncrona usando FileReader
                                const reader = new FileReader();
                                reader.onload = function(e) {
                                    const newPost = {
                                        id: Date.now(),
                                        title: formData.get('postTitle'),
                                        type: formData.get('postType'),
                                        mediaUrl: e.target.result,
                                        mediaType: file.type.startsWith('image/') ? 'image' : 'video',
                                        fileName: file.name,
                                        mediaMethod: 'file',
                                        description: formData.get('postDescription'),
                                        createdAt: new Date().toISOString(),
                                        sessionId: sessionId
                                    };
                                    
                                    // Agregar post y guardar
                                    multimediaContent.push(newPost);
                                    saveNow('multimedia').then(() => {
                                        console.log(`üéØ Post "${newPost.title}" con archivo directo guardado exitosamente`);
                                        displayMultimedia();
                                        multimediaForm.reset();
                                        clearMediaPreview();
                                        document.querySelector('input[name="mediaMethod"][value="file"]').checked = true;
                                        toggleMediaMethod('file');
                                    });
                                };
                                reader.readAsDataURL(file);
                                return; // Salir para evitar procesamiento duplicado
                            }
                        }
                    } else {
                        // Usar URL externa
                        mediaContent = formData.get('mediaUrl') || null;
                        mediaType = 'url';
                    }
                    
                    const newPost = {
                        id: Date.now(),
                        title: formData.get('postTitle'),
                        type: formData.get('postType'),
                        mediaUrl: mediaContent,
                        mediaType: mediaType,
                        fileName: fileName,
                        mediaMethod: mediaMethod,
                        description: formData.get('postDescription'),
                        createdAt: new Date().toISOString(),
                        sessionId: sessionId
                    };
                    
                    // Agregar post y guardar autom√°ticamente
                    multimediaContent.push(newPost);
                    
                    // Guardado inmediato con raz√≥n espec√≠fica
                    saveNow('multimedia').then(() => {
                        console.log(`üéØ Post "${newPost.title}" publicado y guardado exitosamente`);
                        displayMultimedia(); // Actualizar vista inmediatamente
                        multimediaForm.reset();
                        clearMediaPreview(); // Limpiar vista previa multimedia
                        
                        // Resetear m√©todo de multimedia a archivo
                        document.querySelector('input[name="mediaMethod"][value="file"]').checked = true;
                        toggleMediaMethod('file');
                    }).catch(error => {
                        console.error('‚ùå Error guardando multimedia:', error);
                        showSaveIndicator('‚ùå Error al guardar post - Reintentando...', true);
                        setTimeout(() => saveNow('multimedia_retry'), 2000);
                    });
                });
                
                // Auto-guardado mientras se escribe
                const multimediaInputs = multimediaForm.querySelectorAll('input, select, textarea');
                multimediaInputs.forEach(input => {
                    let inputTimeout;
                    input.addEventListener('input', function() {
                        clearTimeout(inputTimeout);
                        inputTimeout = setTimeout(() => {
                            smartSave('multimedia_cambio');
                        }, 3000);
                    });
                });
            }
            
            // ========== SISTEMA DE AUTO-GUARDADO M√öLTIPLE AVANZADO ==========
            
            // 1. Guardado cada 5 segundos (muy frecuente para flujo continuo)
            setInterval(() => {
                smartSave('autom√°tico_5s');
            }, 5000);
            
            // 2. Guardado cada 30 segundos (frecuente)
            setInterval(() => {
                saveNow('autom√°tico_30s');
            }, 30000);
            
            // 3. Guardado de seguridad cada minuto
            setInterval(() => {
                console.log('üîí Guardado de seguridad ejecutado');
                saveNow('seguridad_1m');
            }, 60000);
            
            // 4. Guardado cada 5 minutos (backup completo)
            setInterval(() => {
                console.log('üíæ Backup completo ejecutado');
                saveNow('backup_5m');
            }, 300000);
            
            // 5. Guardado antes de cerrar/recargar p√°gina
            window.addEventListener('beforeunload', function(e) {
                // Guardado s√≠ncrono para asegurar que se complete
                try {
                    localStorage.setItem('compania67_members', JSON.stringify(members));
                    localStorage.setItem('compania67_multimedia', JSON.stringify(multimediaContent));
                    localStorage.setItem('compania67_events', JSON.stringify(events));
                    localStorage.setItem('compania67_lastSave', Date.now().toString());
                    console.log('üíæ Guardado de emergencia antes de cerrar');
                } catch (error) {
                    console.error('‚ùå Error en guardado de emergencia:', error);
                }
            });
            
            // 6. Guardado cuando la p√°gina pierde el foco
            window.addEventListener('blur', function() {
                saveNow('blur');
                console.log('üëÅÔ∏è Guardado al perder foco');
            });
            
            // 7. Guardado y recarga cuando la p√°gina recupera el foco
            window.addEventListener('focus', function() {
                // Primero guardar datos actuales
                saveNow('focus_save').then(() => {
                    // Luego recargar por si hubo cambios en otra pesta√±a
                    loadAllData();
                    
                    // Actualizar vistas si estamos en p√°ginas relevantes
                    const currentPage = document.querySelector('.page.active');
                    if (currentPage) {
                        const pageId = currentPage.id;
                        if (pageId === 'miembros') displayMembers();
                        if (pageId === 'multimedia') displayMultimedia();
                        if (pageId === 'formaciones') displayEvents();
                    }
                    
                    console.log('üëÅÔ∏è Datos guardados y recargados al recuperar foco');
                });
            });
            
            // 8. Detectar cambios en localStorage de otras pesta√±as (sincronizaci√≥n multi-pesta√±a)
            window.addEventListener('storage', function(e) {
                if (e.key && e.key.startsWith('compania67_')) {
                    console.log('üîÑ Cambio detectado en otra pesta√±a:', e.key);
                    
                    // Recargar datos espec√≠ficos
                    if (e.key === 'compania67_members') {
                        loadMembers();
                        if (document.querySelector('#miembros.active')) displayMembers();
                    }
                    if (e.key === 'compania67_multimedia') {
                        loadMultimedia();
                        if (document.querySelector('#multimedia.active')) displayMultimedia();
                    }
                    if (e.key === 'compania67_events') {
                        loadEvents();
                        if (document.querySelector('#formaciones.active')) displayEvents();
                    }
                    if (e.key === 'compania67_theme') {
                        loadTheme();
                    }
                    
                    showSaveIndicator('üîÑ Sincronizado con otra pesta√±a');
                }
            });
            
            // 9. Guardado al cambiar de p√°gina
            const originalShowPage = window.showPage;
            window.showPage = function(pageId) {
                smartSave('navegacion').then(() => {
                    originalShowPage(pageId);
                });
            };
            
            // 10. Guardado al cambiar tema
            const originalToggleTheme = window.toggleTheme;
            window.toggleTheme = function() {
                originalToggleTheme();
                saveNow('tema');
            };
            
            // 11. Monitoreo de actividad del usuario
            let userActivityTimeout;
            function resetActivityTimer() {
                clearTimeout(userActivityTimeout);
                userActivityTimeout = setTimeout(() => {
                    smartSave('inactividad');
                    console.log('üí§ Guardado por inactividad del usuario');
                }, 30000); // 30 segundos de inactividad
            }
            
            // Detectar actividad del usuario
            ['click', 'keypress', 'scroll', 'mousemove'].forEach(event => {
                document.addEventListener(event, resetActivityTimer, { passive: true });
            });
            
            // Iniciar timer de actividad
            resetActivityTimer();
            
            console.log('üéØ Sistema de auto-guardado m√∫ltiple activado con 11 mecanismos diferentes');
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'987619d05740cfe2',t:'MTc1OTI2MDI3MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
